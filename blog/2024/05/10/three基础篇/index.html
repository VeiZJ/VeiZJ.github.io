<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="基础材质基类：Material定义：材质描述了对象objects的外光，它们的定义方式与渲染器无关，如果使用不同的渲染器，则不必重写材质。   整体上来看，就是渲染表现能力越强，占用的计算机硬件资源更多。  占用渲染资源 MeshBasicMaterial &lt; MeshLambertMaterial &lt; MeshPhongMaterial &lt; MeshStandardMateri">
<meta property="og:type" content="article">
<meta property="og:title" content="three基础篇">
<meta property="og:url" content="http://example.com/blog/2024/05/10/three%E5%9F%BA%E7%A1%80%E7%AF%87/index.html">
<meta property="og:site_name" content="VEI">
<meta property="og:description" content="基础材质基类：Material定义：材质描述了对象objects的外光，它们的定义方式与渲染器无关，如果使用不同的渲染器，则不必重写材质。   整体上来看，就是渲染表现能力越强，占用的计算机硬件资源更多。  占用渲染资源 MeshBasicMaterial &lt; MeshLambertMaterial &lt; MeshPhongMaterial &lt; MeshStandardMateri">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/three/1702368339909.png">
<meta property="og:image" content="http://example.com/img/three/1702368442450.png">
<meta property="og:image" content="http://example.com/img/three/1702370190692.png">
<meta property="og:image" content="http://example.com/img/three/1702368996979.png">
<meta property="og:image" content="http://example.com/img/three/1702368060275.png">
<meta property="og:image" content="http://example.com/img/three/1702435513665.png">
<meta property="og:image" content="http://example.com/img/three/1702544424552.png">
<meta property="og:image" content="http://example.com/img/three/1712822846881.png">
<meta property="og:image" content="http://example.com/img/three/1713148838218.png">
<meta property="og:image" content="http://example.com/img/three/1713149897591.png">
<meta property="og:image" content="http://example.com/img/three/1713153199017.png">
<meta property="og:image" content="http://example.com/img/three/1712907318826.png">
<meta property="og:image" content="http://example.com/img/three/1713170230091.png">
<meta property="og:image" content="http://example.com/img/three/1713253141908.png">
<meta property="og:image" content="http://example.com/img/three/1713321813858.png">
<meta property="og:image" content="http://example.com/img/three/1713321203283.png">
<meta property="og:image" content="http://example.com/blog/2024/05/10/three%E5%9F%BA%E7%A1%80%E7%AF%87/img/three/1713348789513.png">
<meta property="og:image" content="http://example.com/img/three/1713778296664.png">
<meta property="og:image" content="http://example.com/blog/2024/05/10/three%E5%9F%BA%E7%A1%80%E7%AF%87/img/three/1713778832957.png">
<meta property="og:image" content="http://example.com/img/three/1714356663966.png">
<meta property="og:image" content="http://example.com/img/three/1714375185358.png">
<meta property="og:image" content="http://example.com/img/three/1714375233084.png">
<meta property="og:image" content="http://example.com/img/three/1714442633565.png">
<meta property="article:published_time" content="2024-05-10T09:47:16.000Z">
<meta property="article:modified_time" content="2025-07-17T10:00:33.190Z">
<meta property="article:author" content="veizj">
<meta property="article:tag" content="ThreeJS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/three/1702368339909.png">

<link rel="canonical" href="http://example.com/blog/2024/05/10/three%E5%9F%BA%E7%A1%80%E7%AF%87/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>three基础篇 | VEI</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/rss2.xml" title="VEI" type="application/rss+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">VEI</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/blog/2024/05/10/three%E5%9F%BA%E7%A1%80%E7%AF%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="veizj">
      <meta itemprop="description" content="选择有时候比努力更重要">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VEI">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          three基础篇
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-05-10 17:47:16" itemprop="dateCreated datePublished" datetime="2024-05-10T17:47:16+08:00">2024-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-07-17 18:00:33" itemprop="dateModified" datetime="2025-07-17T18:00:33+08:00">2025-07-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ThreeJs/" itemprop="url" rel="index"><span itemprop="name">ThreeJs</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>42k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>38 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><h3 id="材质"><a href="#材质" class="headerlink" title="材质"></a>材质</h3><h4 id="基类：Material"><a href="#基类：Material" class="headerlink" title="基类：Material"></a>基类：Material</h4><p>定义：材质描述了对象objects的外光，它们的定义方式与渲染器无关，如果使用不同的渲染器，则不必重写材质。</p>
<p><img src="/img/three/1702368339909.png" alt="1702368339909"></p>
<p><img src="/img/three/1702368442450.png" alt="1702368442450"></p>
<p>整体上来看，就是渲染表现能力越强，占用的计算机硬件资源更多。</p>
<ul>
<li>占用渲染资源 MeshBasicMaterial &lt; MeshLambertMaterial &lt; MeshPhongMaterial &lt; MeshStandardMaterial &lt; MeshPhysicalMaterial</li>
<li>渲染表现能力 MeshBasicMaterial &lt; MeshLambertMaterial &lt; MeshPhongMaterial &lt; MeshStandardMaterial &lt; MeshPhysicalMaterial</li>
</ul>
<h5 id="材质或集合体共享"><a href="#材质或集合体共享" class="headerlink" title="材质或集合体共享"></a>材质或集合体共享</h5><p>我们可以直接访问并修改物体的材质对象，因为材质事共享的如果对其进行修改该用到该材质的物体都会发生改变</p>
<p>我们同时也可以直接访问并修改物体的集合体对象，若有其他物体也是用到这个集合体 修改后也会造成影响。</p>
<p><img src="/img/three/1702370190692.png" alt="1702370190692"></p>
<h5 id="三维变量的克隆和复制方法"><a href="#三维变量的克隆和复制方法" class="headerlink" title="三维变量的克隆和复制方法"></a>三维变量的克隆和复制方法</h5><p>let v1 &#x3D; new three.Vector(1,2,3)</p>
<p>letv2 &#x3D; v1.clone() &#x2F;&#x2F;此时会克隆一个与v1一样属性与值得对象</p>
<p>let v3 &#x3D;  {}</p>
<p>v3.copy(v1)可将v1得值赋值给v3 </p>
<p>若是物体得克隆 他的材质与集合体不单独进行克隆得话 那么材质和集合体还是存在共享问题</p>
<p><img src="/img/three/1702368996979.png" alt="1702368996979"></p>
<h4 id="顶点："><a href="#顶点：" class="headerlink" title="顶点："></a>顶点：</h4><p>顶点的每个坐标对应一个顶点法线 ，法线关系光照后阴影的角度。</p>
<p>物体的属性有一些列的属性：position,rotation,scalr等属性 还有相关的方法，其都会继承父级构造函数的属性和方法</p>
<p>向量：normalize 将向量转为单位向量 长度为1</p>
<p><img src="/img/three/1702368060275.png" alt="1702368060275"></p>
<h3 id="组对象group"><a href="#组对象group" class="headerlink" title="组对象group"></a>组对象group</h3><p><img src="/img/three/1702435513665.png" alt="1702435513665"></p>
<p>子对象：group得children属性下可以查看到这个组对象下面得所有子对象。</p>
<p>子对象任何变化始终都是根据着父节点进行的。我们也可以直接使用Object3D创建一个节点对象，也可以给网格添加子对象。</p>
<p>通过设置name 可以给相应的物体设置指定的名字。</p>
<p>Object3D.traverse遍历所有的子节点</p>
<p>Object3D.getObjectByName() 获取指定名称的节点</p>
<p>本地坐标：当前物体的的坐标就是position的位置</p>
<p>Object3D.postion 表示物体的局部位置</p>
<p>世界坐标：本地坐标加上所有上级的坐标累加坐标，是为子集物体始终是相对于父级物体进行偏移的 </p>
<p>Object3D.getWordPosition（v3）:将当前物体的三维坐标存在一个三维向量中，可以获取当这个物体的世界坐标</p>
<p>当我们通过translate修改了集合体顶点坐标的时候，该物体的局部坐标系并没有发生改变，所有我们对这个物体（object3d）的一些列操作（如rotate）这个物体模型会相对于坐标原点进行</p>
<p>物体隐藏visible：物体object3d 隐藏或显示一个模型。 隐藏父级物体 他的子集物体也会被隐藏</p>
<p> 材质隐藏visible：材质materail 通过该属性可以控制是否隐藏该材质对应的模型对象。 相同材质的隐藏的话 所有使用到此材质的物体的模型都会被隐藏</p>
<p>object3d.remove:  scene , mesh ,都有删除这个方法 与add添加模型对立，可以删除他的子代模型 如“senec.remove(light)删除环境光，因为光照也是通过add添加的 ，场景模型多的话可以遍历子代模型条件删除一些模型。在进行删除尝试中发现了一个微妙的问题，就是在遍历traverse中不建议直接删除当前的属性。会出现一些奇怪的问题</p>
<p><img src="/img/three/1702544424552.png" alt="1702544424552"></p>
<h4 id="模型数的遍历"><a href="#模型数的遍历" class="headerlink" title="模型数的遍历"></a>模型数的遍历</h4><p>object3D.traverse() 遍历了下面的所有子子节点。</p>
<p>object3D.getObjectByName() 根据Object.name来查找对应的名字的模型</p>
<p>object3D.visible  控制模型的显示与隐藏</p>
<h4 id="模型-gltf"><a href="#模型-gltf" class="headerlink" title="模型:gltf"></a>模型:gltf</h4><p>包含内容：几乎包含了该模型的所有数据 模型的层级关系,rgb材质，纹理材质,骨骼动画，变形动画…</p>
<p>格式信息：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;asset&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 模型材质信息</span></span><br><span class="line">  <span class="attr">&quot;materials&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;pbrMetallicRoughness&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="comment">//PBR材质</span></span><br><span class="line">        <span class="attr">&quot;baseColorFactor&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;metallicFactor&quot;</span><span class="punctuation">:</span> <span class="number">0.5</span><span class="punctuation">,</span><span class="comment">//金属度</span></span><br><span class="line">        <span class="attr">&quot;roughnessFactor&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="comment">//粗糙度</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 网格模型数据</span></span><br><span class="line">  <span class="attr">&quot;meshes&quot;</span><span class="punctuation">:</span> ...</span><br><span class="line">  <span class="comment">// 纹理贴图</span></span><br><span class="line">  <span class="attr">&quot;images&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="comment">// uri指向外部图像文件</span></span><br><span class="line">            <span class="attr">&quot;uri&quot;</span><span class="punctuation">:</span> <span class="string">&quot;贴图名称.png&quot;</span><span class="comment">//图像数据也可以直接存储在.gltf文件中</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;buffers&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="comment">// 一个buffer对应一个二进制数据块，可能是顶点位置 、顶点索引等数据</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;byteLength&quot;</span><span class="punctuation">:</span> <span class="number">840</span><span class="punctuation">,</span></span><br><span class="line">     <span class="comment">//这里面的顶点数据，也快成单独以.bin文件的形式存在   </span></span><br><span class="line">      <span class="attr">&quot;uri&quot;</span><span class="punctuation">:</span> <span class="string">&quot;data:application/octet-stream;base64,AAAAPwAAAD8AAAA/AAAAPwAAAD8AAAC/.......</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  ],</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p>gltf格式文件不一定就是以扩展名.gltf结尾，.glb就是gltf格式的二进制文件。比如你可以把.gltf模型和贴图信息全部合成得到一个.glb文件中，.glb文件相对.gltf文件体积更小，网络传输自然更快。</p>
<p><strong>load（’模型地址’，加载成功后的函数，加载时的相关信息）</strong>:我们可以在加载函数中再次处理这个模型，如修改模型的相关属性，可以通过第三个参数来设置相关进度条…</p>
<p><strong>查询模型节点</strong>：getObjectName() 根据模型的name属性来查询谋和模型对象</p>
<p><strong>遍历模型<code>traverse</code></strong>:</p>
<p><strong>查看gltf的默认材质</strong>：</p>
<p>材质相同问题：模型材质共享的问题判断材质的name 是否相同，</p>
<p>解决方案：1,三维建模软件中设置,需要代码改变材质不要共享，要独享材质。2,代码批量更改，克隆材质对象，重新赋值给mesh的材质属性.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gltf.<span class="property">scne</span>.<span class="title function_">getObjectByName</span>(<span class="string">&#x27;汽车&#x27;</span>).<span class="title function_">traverse</span>(<span class="keyword">function</span>(<span class="params">item</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(item.<span class="property">isMesh</span>)&#123;</span><br><span class="line">        item.<span class="property">material</span> = obj.<span class="property">material</span>.<span class="title function_">clone</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="纹理"><a href="#纹理" class="headerlink" title="纹理"></a>纹理</h4><p>如果没有特殊的需求，一般为了正常渲染，避免色差，three.js中贴图的颜色空间编码属性encoding要与webGL渲染器的outputEncoding属性（最新版本中属性名已改为 outputColorSpace ）保持一致。</p>
<p>纹理对象的encoding有多个属性：THREE.LinearEncoding（线性颜色空间：3000 ）,THREE.sRGBEncoding （sRGB颜色空间：3001）</p>
<p>如果webGL的渲染器的色彩空间手动设置了后面的添加的纹理也需要设置成相关的色彩空间（最新版中纹理对象的色彩空间属性名已由encoding改为colorSpace）</p>
<p>给gltf模型更换颜色贴图：TextureLoader()加载新的模型数据 如果直接给gltf的模型材质map设置新的纹理会出现错位的情况，这和贴图的texture的翻转flipY属性有关。</p>
<p>纹理对象的flipY默认值为trun ,gltf的贴图flipY默认值为false,跟换模型的贴图时需要设置为false.</p>
<p>纹理的列阵wrapS wrapT 分别是在UV轴上的如何进行包裹。repeat在uv轴上重复的数量</p>
<p>环境贴图：</p>
<p>立方体纹理加载器cubetextureLoader </p>
<p>这个加载器加载六个图片作为空间的上下左右前后，这个用来加载环境贴图，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载环境贴图</span></span><br><span class="line"><span class="comment">// 加载周围环境6个方向贴图</span></span><br><span class="line"><span class="comment">// 上下左右前后6张贴图构成一个立方体空间</span></span><br><span class="line"><span class="comment">// &#x27;px.jpg&#x27;, &#x27;nx.jpg&#x27;：x轴正方向、负方向贴图  p:正positive  n:负negative</span></span><br><span class="line"><span class="comment">// &#x27;py.jpg&#x27;, &#x27;ny.jpg&#x27;：y轴贴图</span></span><br><span class="line"><span class="comment">// &#x27;pz.jpg&#x27;, &#x27;nz.jpg&#x27;：z轴贴图</span></span><br><span class="line"><span class="keyword">const</span> textureCube = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CubeTextureLoader</span>()</span><br><span class="line">    .<span class="title function_">setPath</span>(<span class="string">&#x27;./环境贴图/环境贴图0/&#x27;</span>)</span><br><span class="line">    .<span class="title function_">load</span>([<span class="string">&#x27;px.jpg&#x27;</span>, <span class="string">&#x27;nx.jpg&#x27;</span>, <span class="string">&#x27;py.jpg&#x27;</span>, <span class="string">&#x27;ny.jpg&#x27;</span>, <span class="string">&#x27;pz.jpg&#x27;</span>, <span class="string">&#x27;nz.jpg&#x27;</span>]);</span><br><span class="line">    <span class="comment">// CubeTexture表示立方体纹理对象，父类是纹理对象Texture </span></span><br></pre></td></tr></table></figure>



<p>材质MeshStandardMaterial的envMap环境贴图属性，通过pbr材质的贴图属性反射周围的景物。</p>
<p>envMapIntensity属性控制了反光率 <code>roughness</code>：控制粗糙度</p>
<p>环境贴图的色彩空间编码应该与渲染器的保持一致</p>
<p><strong>&#x2F;&#x2F;pbr材质的相关属性：</strong></p>
<p>clearcoat：可以给物体表面设置一层透明膜，就像一层透明的漆，范围在0-1.</p>
<p>clearcoatRoughness：0-1 ；清漆层的粗糙层度。</p>
<p>metalness: 0.9,&#x2F;&#x2F;车外壳金属度<br>roughness: 0.5,&#x2F;&#x2F;车外壳粗糙度</p>
<p>transmission 玻璃透明度</p>
<p>Ior:折光率</p>
<h5 id="场景的背景："><a href="#场景的背景：" class="headerlink" title="场景的背景："></a>场景的背景：</h5><p> 透明度：new Three.WebGLRenderer({alpha：true})或 render.setColorAlpha:0-1</p>
<p>背景色：render.setClearColor(颜色,透明度)</p>
<h6 id="导出图片："><a href="#导出图片：" class="headerlink" title="导出图片："></a>导出图片：</h6><p>1.创建a标签 </p>
<p>2.设置a标签的herf的 为场景的canvas元素，可以通过render.domElement获取</p>
<p>3.渲染器设置preserveDrawingBuffer为true ，开启缓存。</p>
<p>4.通过canvas的toDataURL(‘image&#x2F;png’)获取话不上的像素信息，将以png的格式保存。</p>
<h6 id="mesh重叠时候会出现闪缩的情况叫做深度冲突（z-fighting）"><a href="#mesh重叠时候会出现闪缩的情况叫做深度冲突（z-fighting）" class="headerlink" title="mesh重叠时候会出现闪缩的情况叫做深度冲突（z-fighting）"></a>mesh重叠时候会出现闪缩的情况叫做深度冲突（z-fighting）</h6><h5 id="自定义划线：顶点数据来画"><a href="#自定义划线：顶点数据来画" class="headerlink" title="自定义划线：顶点数据来画"></a>自定义划线：顶点数据来画</h5><p>几何体setFromPoints（v3）将v3顶点数据设为几何体的attribute.position的顶点位置属性。除了可以是三维向量数组还可以是二位向量数组。</p>
<h5 id="曲线：基类cuver"><a href="#曲线：基类cuver" class="headerlink" title="曲线：基类cuver"></a>曲线：基类cuver</h5><p><img src="/img/three/1712822846881.png" alt="1712822846881"></p>
<h3 id="管道几何体"><a href="#管道几何体" class="headerlink" title="管道几何体"></a>管道几何体</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TubeGeometry(path, tubularSegments, radius, radiusSegments, closed)</span><br></pre></td></tr></table></figure>



<h3 id="旋转成型几何体"><a href="#旋转成型几何体" class="headerlink" title="旋转成型几何体"></a>旋转成型几何体</h3><p><strong>LatheGeometry</strong>：通过一个圆形轮廓坐标点 旋转得到一个几何体曲面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LatheGeometry(points, segments, phiStart, phiLength)</span><br><span class="line">points为一个二维矢量组成的一个线段 segments为细分数， phiStart开始角度 phiLength旋转的角度默认值2π</span><br></pre></td></tr></table></figure>

<h3 id="形状几何体"><a href="#形状几何体" class="headerlink" title="形状几何体"></a>形状几何体</h3><p><strong>ShapeGeometry：</strong>通过一个集合的轮廓得到一个多边形几何体平面。</p>
<p>先通过 Shape 将这些点生成一个二维平面，shape([二维矢量点数组…])</p>
<p> 用ShapeGeometry 将这个二位平面装维平面几何体  ShapeGeometry （shape）</p>
<h3 id="多边形轮廓shape-重点"><a href="#多边形轮廓shape-重点" class="headerlink" title="多边形轮廓shape(重点)"></a>多边形轮廓shape(重点)</h3><p>使用一些列路径传入shape生成一个多边形的形状，它可以和<strong>ExtrudeGeometry</strong>、<strong>ShapeGeometry</strong>一起使用，获取点，或者获取三角，也可以获得一个该形状的几何体，非常Nice.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">父类为Path，所以也是继承了父类的相关方法与属性，如画线，画圆，画椭圆，等等获取当前点等属性。</span><br><span class="line">传入点组成opints，可构造一个自定任意形状的多边形</span><br></pre></td></tr></table></figure>



<p><img src="/img/three/1713148838218.png" alt="1713148838218"></p>
<p><strong>若线与圆弧组合的时候，第一次的结束点自动衍生至第二个圆弧的起点。当前一次线画完时会采取以当前的currentPoint为中心点。</strong></p>
<p><strong>shape的线与圆共同使用的时候，他们的起点会相连接</strong></p>
<p><img src="/img/three/1713149897591.png" alt="1713149897591"></p>
<h6 id="内孔：holes"><a href="#内孔：holes" class="headerlink" title="内孔：holes"></a>内孔：holes</h6><p>在创建的shape内挖出对应的孔洞，这些孔洞的坐标位置相对原点。</p>
<p><img src="/img/three/1713153199017.png" alt="1713153199017"></p>
<h3 id="边缘几何体"><a href="#边缘几何体" class="headerlink" title="边缘几何体"></a>边缘几何体</h3><p><strong>EdgesGeometry</strong>：给指定几何体添加外边框线查看其边缘。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">// 集合体的边界线EdgesGeometry</span></span><br><span class="line">    <span class="keyword">const</span> geometryModle = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CylinderGeometry</span>(<span class="number">2</span>,<span class="number">2</span>,<span class="number">32</span>)</span><br><span class="line">    <span class="keyword">const</span> materialModle = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">        <span class="attr">color</span>: <span class="number">0x004444</span>,</span><br><span class="line">        <span class="attr">transparent</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">opacity</span>:<span class="number">0.5</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> mesh2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geometryModle,materialModle)</span><br><span class="line">    	scene.<span class="title function_">add</span>(mesh2)</span><br><span class="line">    <span class="keyword">const</span> edgesGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">EdgesGeometry</span>(geometryModle,<span class="number">30</span>)<span class="comment">//第二次参数时发现角度大于	多少时才会渲染</span></span><br><span class="line">    <span class="keyword">const</span> edgesMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LineBasicMaterial</span>(&#123;</span><br><span class="line">        <span class="attr">color</span>: <span class="number">0x00ffff</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> lineModle = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LineSegments</span>(edgesGeometry,edgesMaterial)</span><br><span class="line">    	scene.<span class="title function_">add</span>(lineModle)</span><br><span class="line">	<span class="comment">// 同理相关模型也可以在加载完成后也可以添加边缘线。</span></span><br><span class="line">modelLoader.<span class="title function_">load</span>(<span class="string">&#x27;./bwm/scene.gltf&#x27;</span>,<span class="function">(<span class="params">gltf</span>)=&gt;</span>&#123;</span><br><span class="line">        gltf.<span class="property">scene</span>.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">5</span>,<span class="number">0</span>,<span class="number">5</span>)</span><br><span class="line">        gltf.<span class="property">scene</span>.<span class="title function_">traverse</span>(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(item.<span class="property">isMesh</span>)&#123;</span><br><span class="line">                item.<span class="property">material</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;<span class="comment">//设置新的材质属性</span></span><br><span class="line">                     <span class="attr">color</span>: <span class="number">0x004444</span>,</span><br><span class="line">                     <span class="attr">transparent</span>: <span class="literal">true</span>,</span><br><span class="line">                     <span class="attr">opacity</span>: <span class="number">0.5</span>,</span><br><span class="line">                 &#125;)</span><br><span class="line">                 <span class="keyword">const</span> itemEdge = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">EdgesGeometry</span>(item.<span class="property">geometry</span>)<span class="comment">//创建外框线</span></span><br><span class="line">                 <span class="keyword">const</span> itemLineMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LineBasicMaterial</span>(&#123;<span class="comment">//线性材质</span></span><br><span class="line">                     <span class="attr">color</span>: <span class="number">0x00ffff</span>,</span><br><span class="line">                 &#125;)</span><br><span class="line">                 <span class="keyword">const</span> itemLine = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Line</span>(itemEdge,itemLineMaterial)</span><br><span class="line">                 item.<span class="title function_">add</span>(itemLine)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">       	scene.<span class="title function_">add</span>(gltf.<span class="property">scene</span>)<span class="comment">//模型添加到场景中</span></span><br></pre></td></tr></table></figure>



<h3 id="拉伸几何体"><a href="#拉伸几何体" class="headerlink" title="拉伸几何体"></a>拉伸几何体</h3><p>**ExtrudeGeometry :**也是通过一个平面坐标拉成一个几何体，</p>
<p>参数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">depth</span>: <span class="number">20</span>,</span><br><span class="line"> <span class="attr">bevelThickness</span>: <span class="number">5</span>, <span class="comment">//倒角尺寸:拉伸方向</span></span><br><span class="line"> <span class="attr">bevelSize</span>: <span class="number">5</span>, <span class="comment">//倒角尺寸:垂直拉伸方向</span></span><br><span class="line"> <span class="attr">bevelSegments</span>: <span class="number">20</span>, <span class="comment">//倒圆角：倒角细分精度，默认3</span></span><br><span class="line"> <span class="attr">extrudePath</span>:cuverpath<span class="comment">//通过一个三维曲线让这个多变对其沿着这个曲线拉伸</span></span><br><span class="line"> <span class="attr">steps</span>:<span class="number">100</span><span class="comment">//沿着路径细分精度，越大越光滑</span></span><br></pre></td></tr></table></figure>



<p><img src="/img/three/1712907318826.png" alt="1712907318826"></p>
<h5 id="弯曲水管流动效果："><a href="#弯曲水管流动效果：" class="headerlink" title="弯曲水管流动效果："></a>弯曲水管流动效果：</h5><p>贴图版本：创建一个贴图，然后将贴图设置一个阵列模式。再render函数中给贴图的x轴的点进行+1。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pointsV = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CatmullRomCurve3</span>([</span><br><span class="line">        <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">20</span>,<span class="number">10</span>,<span class="number">5</span>),</span><br><span class="line">        <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>),</span><br><span class="line">        <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(-<span class="number">20</span>,-<span class="number">15</span>,-<span class="number">50</span>),</span><br><span class="line">    ])</span><br><span class="line">    <span class="keyword">const</span> pipeBackgroundImage = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>().<span class="title function_">load</span>(img)</span><br><span class="line">    <span class="comment">// pipeBackgroundImage.encoding = THREE.SRGBColorSpace</span></span><br><span class="line">   <span class="comment">// 设置阵列模式</span></span><br><span class="line">    pipeBackgroundImage.<span class="property">wrapS</span> = <span class="variable constant_">THREE</span>.<span class="property">RepeatWrapping</span>;</span><br><span class="line">    pipeBackgroundImage.<span class="property">wrapT</span> = <span class="variable constant_">THREE</span>.<span class="property">RepeatWrapping</span>;</span><br><span class="line">    <span class="comment">// uv两个方向纹理重复数量</span></span><br><span class="line">    pipeBackgroundImage.<span class="property">repeat</span>.<span class="title function_">set</span>(<span class="number">1</span>,<span class="number">1</span>);<span class="comment">//注意选择合适的阵列数量</span></span><br><span class="line">    pipeBackgroundImage.<span class="property">encoding</span> = <span class="variable constant_">THREE</span>.<span class="property">SRGBColorSpace</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(pipeBackgroundImage,<span class="string">&#x27;tuoian&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> pipeline = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TubeGeometry</span>(pointsV,<span class="number">65</span>, <span class="number">2</span>, <span class="number">25</span>)</span><br><span class="line">    <span class="keyword">const</span> pipeMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshPhysicalMaterial</span>(&#123;<span class="attr">emissive</span>:<span class="string">&#x27;#3f7b9d&#x27;</span>,<span class="attr">side</span>:<span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>,<span class="attr">map</span>:pipeBackgroundImage,<span class="attr">clearcoat</span>:<span class="number">1</span>&#125;)</span><br><span class="line">    <span class="keyword">const</span> pipeMesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(pipeline,pipeMaterial)</span><br><span class="line">    scene.<span class="title function_">add</span>(pipeMesh)</span><br><span class="line"> <span class="keyword">function</span> <span class="title function_">animation</span>(<span class="params"></span>)&#123;</span><br><span class="line">        pipeBackgroundImage.<span class="property">offset</span>.<span class="property">x</span> += <span class="number">0.0001</span>; <span class="comment">//uv动画</span></span><br><span class="line">        renderer.<span class="title function_">render</span>(scene,camera)</span><br><span class="line">        <span class="title function_">requestAnimationFrame</span>(animation)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">animation</span>(<span class="params"></span>)&#123;</span><br></pre></td></tr></table></figure>

<h3 id="几何体的顶点属性"><a href="#几何体的顶点属性" class="headerlink" title="几何体的顶点属性"></a>几何体的顶点属性</h3><p>顶点<strong>位置</strong>数据<code>geometry.attributes.position</code></p>
<p>顶点<strong>法向量</strong>数据<code>geometry.attributes.normal</code></p>
<p>顶点<strong>UV</strong>数据<code>geometry.attributes.uv</code></p>
<p>顶点<strong>颜色</strong>数据<code>geometry.attributes.color</code></p>
<p>如何使用顶点颜色: 创建相关几何体时，通过设置起这个几何体顶点数量的颜色。</p>
<p>*若要添加顶点颜色需要在材质中开启vertexColors ，材质的color属性可以不用设置了 </p>
<p>*rgb 范围1-0</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const colors = new Float32Array([</span><br><span class="line">	 1, 0, 0, //顶点1颜色 </span><br><span class="line">     0, 0, 1, //顶点2颜色</span><br><span class="line">     0, 1, 0, //顶点3颜色</span><br><span class="line">     ])</span><br><span class="line">geotry.attributes.color = new three.BufferAttribute(colors,3) //三个一组</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><em>颜色的rgb范围如下图  ↓</em></p>
<p><img src="/img/three/1713170230091.png" alt="1713170230091"></p>
<p>绘制彩色曲线</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.创建一个三维贝塞尔曲线或者其他曲线</span></span><br><span class="line"><span class="keyword">const</span> peakCover = <span class="keyword">new</span> three.<span class="title class_">CubicBezierCurve3</span>(</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">7</span>,<span class="number">6</span>,<span class="number">6</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.获取这个曲线上的所有点位 .getpoints() 参数将曲线分割为多少个点</span></span><br><span class="line"><span class="keyword">const</span> peackPoints = peackCover.<span class="title function_">getpoints</span>(<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.设置这些点位的颜色</span></span><br><span class="line"><span class="keyword">let</span> peackColors = []</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i =<span class="number">0</span>;i&lt;peackPoints.<span class="property">length</span>;i++)&#123;</span><br><span class="line">	<span class="keyword">const</span> itemValue = i / peackPoints.<span class="property">length</span> <span class="comment">//等到这个点位对应的rgb</span></span><br><span class="line">	peackColors.<span class="title function_">push</span>(itemValue,<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//4.设置集合体的顶点数据</span></span><br><span class="line"><span class="keyword">const</span> peackCoverGeotry = <span class="keyword">new</span> three.<span class="title class_">BufferGeometry</span>().<span class="title function_">setFromPoints</span>(<span class="keyword">new</span> <span class="title class_">Float32Array</span>(peackColors),<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//5.创建曲线材质</span></span><br><span class="line"><span class="keyword">const</span> peackCoverMaterial = <span class="keyword">new</span> three.<span class="title class_">LineBasicMaterial</span>(&#123;</span><br><span class="line"> <span class="attr">vertexColors</span>:<span class="literal">true</span>,<span class="comment">//使用顶点颜色渲染</span></span><br><span class="line"> <span class="comment">// color:&#x27;red&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建线条</span></span><br><span class="line"><span class="keyword">const</span> coverLine = <span class="keyword">new</span> three.<span class="title class_">Line</span>(peackCoverGeotry,peackCoverMaterial)</span><br><span class="line">scene.<span class="title function_">add</span>(coverLine)</span><br></pre></td></tr></table></figure>

<h3 id="Color的使用"><a href="#Color的使用" class="headerlink" title="Color的使用"></a>Color的使用</h3><p>THREE.Color(r,g,b) 当所有参数被定义时，r是红色分量，g是绿色分量，b是蓝色分量。<br>当只有 r 被定义时：</p>
<ul>
<li>它可用一个十六进制 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Web_colors#Hex_triplet">hexadecimal triplet</a> 值表示颜色（推荐）。</li>
<li>它可以是一个另一个颜色实例。</li>
<li>它可以是另外一个CSS样式。例如：<ul>
<li>‘rgb(250, 0,0)’</li>
<li>‘rgb(100%,0%,0%)’</li>
<li>‘hsl(0, 100%, 50%)’</li>
<li>‘#ff0000’</li>
<li>‘#f00’</li>
<li>‘red’</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const color = new THREE.Color(r,g,b)</span><br></pre></td></tr></table></figure>

<h6 id="color的插值"><a href="#color的插值" class="headerlink" title="color的插值"></a>color的插值</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//lerpColors</span></span><br><span class="line"><span class="keyword">const</span> c1 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0xff0000</span>); <span class="comment">//红色</span></span><br><span class="line"><span class="keyword">const</span> c2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0x0000ff</span>); <span class="comment">//蓝色</span></span><br><span class="line"><span class="keyword">const</span> c = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>();</span><br><span class="line"><span class="comment">// 颜色3.lerpColors(颜色1，颜色2，占比) 占比为两种颜色各占多少 但占比为0时到的颜色就是颜色1 占比为1时得到的颜色就是颜色2。 </span></span><br><span class="line">c = c.<span class="title function_">lerpColors</span>(c1,c2,占比<span class="title class_">Value</span>)</span><br><span class="line"><span class="comment">// lerp(颜色1,占比value)</span></span><br><span class="line">c1.<span class="title function_">lerp</span>(c2,<span class="number">1</span>)<span class="comment">// 颜色1.lerp(颜色2,占比) 占比为颜色1与颜色2的占比 占比为0为颜色1， 占比为2时为颜色2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> c3 = c1.<span class="title function_">clone</span>().<span class="title function_">lerColor</span>(c1,c2,占比)<span class="comment">//这里是先克隆在用插值修改这个颜色</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>颜色插值的应用:不用自己用相关逻辑来写颜色的属性数组，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">let peakCoverPoint = peakCover.getPoints(20)//获取曲线上的点</span><br><span class="line"> let colorArr = []</span><br><span class="line"> for(let i=0;i&lt; peakCoverPoint.length ;i++)&#123;</span><br><span class="line">     const percent = i / peakCoverPoint.length; //点索引值相对所有点数量的百分比</span><br><span class="line">     //根据顶点位置顺序大小设置颜色渐变</span><br><span class="line">     // 红色分量从0到1变化，蓝色分量从1到0变化</span><br><span class="line">     colorArr.push(percent, 0, 1); //蓝色到红色渐变色</span><br><span class="line"> &#125;</span><br><span class="line"> // 优化↓</span><br><span class="line"> let c1 = new three.Color(0x00ffff)</span><br><span class="line"> let c2 = new three.Color(0xffff00)</span><br><span class="line"> for(let i=0;i&lt; peakCoverPoint.length ;i++)&#123;</span><br><span class="line"> const percent = i / peakCoverPoint.length; //点索引值相对所有点数量的百分比</span><br><span class="line"> //根据顶点位置顺序大小设置颜色渐变</span><br><span class="line"> let c = c1.clone(c2,percent)</span><br><span class="line"> colorArr.push(c.r, c.g, c.b); //颜色插值计算</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="模型的顶点及数据处理"><a href="#模型的顶点及数据处理" class="headerlink" title="模型的顶点及数据处理"></a>模型的顶点及数据处理</h3><p>引入的模型有些在返回的模型json对象的scne.children[0]中有geometry属性。有的会在其下面继续拓展多个物体。此时我们就需要遍历这个对象，去获取他的顶点数据。</p>
<h6 id="BufferAttribute具有getX-getY-getZ-方法获取x-1维-y-2维-z-3维-指定项的数据"><a href="#BufferAttribute具有getX-getY-getZ-方法获取x-1维-y-2维-z-3维-指定项的数据" class="headerlink" title="BufferAttribute具有getX(), getY() ,getZ() 方法获取x(1维) y(2维) z(3维) 指定项的数据"></a>BufferAttribute具有getX(), getY() ,getZ() 方法获取x(1维) y(2维) z(3维) 指定项的数据</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过顶点数据 来将山体根据高度着色</span></span><br><span class="line">modelLoader.<span class="title function_">load</span>(<span class="string">&#x27;shan2.glb&#x27;</span>,<span class="function">(<span class="params">gltf</span>)=&gt;</span>&#123;</span><br><span class="line">       gltf.<span class="property">scene</span>.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">5</span>,<span class="number">0</span>,<span class="number">5</span>)</span><br><span class="line">       <span class="variable language_">console</span>.<span class="title function_">log</span>( gltf.<span class="property">scene</span>);</span><br><span class="line">       gltf.<span class="property">scene</span>.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">25</span>,<span class="number">25</span>,<span class="number">25</span>)</span><br><span class="line"></span><br><span class="line">       <span class="keyword">const</span> zArr = [] <span class="comment">//顶点数据组</span></span><br><span class="line">       <span class="comment">//遍历所有物体的顶点将塞入zArr</span></span><br><span class="line">       gltf.<span class="property">scene</span>.<span class="title function_">traverse</span>(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">           <span class="keyword">let</span> itemAttributes = item.<span class="property">geometry</span>.<span class="property">attributes</span><span class="comment">//顶点属性</span></span><br><span class="line">           <span class="keyword">let</span> itemPosition = item.<span class="property">geometry</span>.<span class="property">attributes</span>.<span class="property">position</span><span class="comment">//顶点位置数据</span></span><br><span class="line">           <span class="comment">//在位置数据中有一个count表示这个物体有多少个顶点</span></span><br><span class="line">           <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>;i&lt;itemPosition.<span class="property">length</span>;i++)&#123;</span><br><span class="line">               zArr.<span class="title function_">push</span>(itemPosition.<span class="title function_">getZ</span>(i))</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;)</span><br><span class="line">       zArr.<span class="title function_">sort</span>()<span class="comment">//升序排序</span></span><br><span class="line">       <span class="keyword">let</span> minHeight = zArr[<span class="number">0</span>]<span class="comment">//山脚高度</span></span><br><span class="line">       <span class="keyword">let</span> maxHeight = zArr[zArr.<span class="property">length</span> - <span class="number">1</span>]<span class="comment">//山顶高度</span></span><br><span class="line">       <span class="keyword">let</span> height = maxHeight - minHeight <span class="comment">//山体的高度</span></span><br><span class="line">	<span class="keyword">let</span> minColor = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0x0000ff</span>)<span class="comment">//山脚颜色</span></span><br><span class="line">       <span class="keyword">let</span> maxColor = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0xff0000</span>)<span class="comment">//山顶颜色</span></span><br><span class="line">       <span class="comment">//再次根据当前顶点个数进行循环 设置当前的顶点颜色</span></span><br><span class="line">	gltf.<span class="property">scene</span>.<span class="title function_">traverse</span>(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">       	<span class="keyword">let</span> itemAttributes = item.<span class="property">geometry</span>.<span class="property">attributes</span><span class="comment">//顶点属性</span></span><br><span class="line">           <span class="keyword">let</span> itemPosition = item.<span class="property">geometry</span>.<span class="property">attributes</span>.<span class="property">position</span><span class="comment">//顶点位置数据</span></span><br><span class="line">           <span class="keyword">let</span> colorArr = []</span><br><span class="line">    		<span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>;i&lt;itemPosition.<span class="property">count</span>;i++)&#123;</span><br><span class="line">               <span class="keyword">let</span> colorVal = (itemPosition.<span class="title function_">getZ</span>(I) - minHeight) / height</span><br><span class="line">               <span class="keyword">let</span> c = minColor.<span class="title function_">clone</span>().<span class="title function_">lerp</span>(maxColor,colorVal)</span><br><span class="line">               colorArr.<span class="title function_">push</span>(c.<span class="property">r</span>,c.<span class="property">g</span>,c.<span class="property">b</span>)</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">let</span> float32Arr = <span class="keyword">new</span> three.<span class="title class_">Float32Array</span>(colorArr)</span><br><span class="line">           itemAttributes.<span class="property">geometry</span>.<span class="property">color</span> = <span class="keyword">new</span> three.<span class="title class_">BufferAttribute</span>(float32Arr,<span class="number">3</span>)</span><br><span class="line">           </span><br><span class="line">           item.<span class="property">material</span> = <span class="keyword">new</span> three.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">                <span class="attr">vertexColors</span>:<span class="literal">true</span><span class="comment">//开启顶点颜色</span></span><br><span class="line">           &#125;)</span><br><span class="line">       &#125;)</span><br><span class="line">       </span><br><span class="line">    &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/img/three/1713253141908.png" alt="1713253141908"></p>
<h3 id="相机camera"><a href="#相机camera" class="headerlink" title="相机camera"></a>相机camera</h3><p><strong>相机种类</strong>：正投影相机 OrthographicCamera  ，透视投影相机 PerspectiveCamera ，立方体相机CubeCamera</p>
<p><strong>正投影相机</strong>：相机所看到的是一个四边形衍生后的空间。 正投影没有透视效果,也就是不会模拟人眼观察世界的效果。 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">OrthographicCamera</span>( left, right, top, bottom, near, far )</span><br><span class="line">left	渲染空间的左边界</span><br><span class="line">right	渲染空间的右边界</span><br><span class="line">top	渲染空间的上边界</span><br><span class="line">bottom	渲染空间的下边界</span><br><span class="line">near	near属性表示的是从距离相机多远的位置开始渲染，一般情况会设置一个很小的值。 默认值<span class="number">0.1</span></span><br><span class="line">far	far属性表示的是距离相机多远的位置截止渲染，如果设置的值偏小小，会有部分场景看不到。 默认值<span class="number">2000</span></span><br><span class="line">left 与 top 为负值</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>相机的position位置若在物体位置左边范围里面 ，会渲染范围外的 ，涉及到范围的坐标的物体这回被切割一般</p>
<p><img src="/img/three/1713321813858.png" alt="1713321813858"></p>
<p><img src="/img/three/1713321203283.png" alt="1713321203283"></p>
<p><strong>透视投影相机</strong>：具有一定角度的锥型视野空间。特点：模拟人眼所看到的物体特征</p>
<p><strong>视觉差异</strong>：同样渲染一个物体，正投影渲染的没有透视相机看着的自然。</p>
<p><strong>相机选择：</strong>对于大部分需要模拟人眼观察效果的场景，需要使用透视投影相机，比如人在场景中<strong>漫游</strong>，或是在高处<strong>俯瞰</strong>整个园区或工厂。</p>
<p>正投影没有透视效果,也就是不会模拟人眼观察世界的效果。在一些不需要透视的场景你可以选择使用正投影相机，比如整体预览一个中国地图的效果，或者一个2D可视化的效果。</p>
<h3 id="WebGL渲染器更新Canvas画布尺寸"><a href="#WebGL渲染器更新Canvas画布尺寸" class="headerlink" title="WebGL渲染器更新Canvas画布尺寸"></a>WebGL渲染器更新Canvas画布尺寸</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">解释<span class="comment">// onresize 事件会在窗口被调整大小时发生</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">onresize</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> width = <span class="variable language_">window</span>.<span class="property">innerWidth</span>; <span class="comment">//canvas画布宽度</span></span><br><span class="line">    <span class="keyword">const</span> height = <span class="variable language_">window</span>.<span class="property">innerHeight</span>; <span class="comment">//canvas画布高度</span></span><br><span class="line">    <span class="comment">// 重置渲染器输出画布canvas尺寸</span></span><br><span class="line">    renderer.<span class="title function_">setSize</span>(width, height);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>也可以在创建的时候就设置render.setSize(window.innerWidth,window.innerHeight)</p>
<p>透视相机需要更新一下宽高比</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">onresize</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">   <span class="comment">// width、height表示canvas画布宽高度</span></span><br><span class="line"> 	 <span class="keyword">const</span> width = canvas.<span class="property">clientWidth</span> <span class="comment">//canvas画布宽度</span></span><br><span class="line">    <span class="keyword">const</span> height = canvas.<span class="property">clientHeight</span> <span class="comment">//canvas画布高度		</span></span><br><span class="line"> camera.<span class="property">aspect</span> = canvas.<span class="property">clientWidth</span>/canvas.<span class="property">clientHeight</span></span><br><span class="line"> camera.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure>

<p>正投相机受到宽高影响left 和 right的影响。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> k = width / height; <span class="comment">//canvas画布宽高比</span></span><br><span class="line"><span class="keyword">const</span> s = <span class="number">50</span>; </span><br><span class="line"><span class="comment">//控制left, right, top, bottom范围大小</span></span><br><span class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">OrthographicCamera</span>(-s * k, s * k, s, -s, <span class="number">1</span>, <span class="number">8000</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Canvas画布跟随窗口变化</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">onresize</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> width = <span class="variable language_">window</span>.<span class="property">innerWidth</span>; <span class="comment">//canvas画布宽度</span></span><br><span class="line">    <span class="keyword">const</span> height = <span class="variable language_">window</span>.<span class="property">innerHeight</span>; <span class="comment">//canvas画布高度</span></span><br><span class="line">    <span class="comment">// 1. WebGL渲染器渲染的Cnavas画布尺寸更新</span></span><br><span class="line">    renderer.<span class="title function_">setSize</span>(width, height);</span><br><span class="line">    <span class="comment">// 2.1.更新相机参数</span></span><br><span class="line">    <span class="keyword">const</span> k = width / height; <span class="comment">//canvas画布宽高比</span></span><br><span class="line">    camera.<span class="property">left</span> = -s*k;</span><br><span class="line">    camera.<span class="property">right</span> = s*k;</span><br><span class="line">    <span class="comment">// 2.2.相机的left, right, top, bottom属性变化了，通知threejs系统</span></span><br><span class="line">    camera.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="包围盒"><a href="#包围盒" class="headerlink" title="包围盒"></a>包围盒</h3><p>包围一个物体外层包围的几何体，就如手办的透明收纳盒。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> box3 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Box3</span>();</span><br></pre></td></tr></table></figure>

<p>expandByObject（mesh）:方法获取这个物体的最小包围盒.</p>
<p>getSize(target:vector3):获取到这个包围盒的大小并赋值给一个v3.</p>
<p>getCenter(target:vector3):获取到这个包围盒的中心点，并赋给一个v3.</p>
<h6 id="包围盒地图案例："><a href="#包围盒地图案例：" class="headerlink" title="包围盒地图案例："></a><strong>包围盒地图案例：</strong></h6><p><strong>在这个案例中涉及到几个点</strong></p>
<p>1.我们如何让地图居中，也就是摄像机如何对着地图，。</p>
<p>2.轨道控制器中心点对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cq <span class="keyword">from</span> <span class="string">&#x27;map.json&#x27;</span> <span class="comment">//地图的json数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//地图使用的正投影相机</span></span><br><span class="line"><span class="keyword">const</span> width = canvas.<span class="property">clientWidth</span>; <span class="comment">//canvas画布宽度</span></span><br><span class="line">   <span class="keyword">const</span> height = canvas.<span class="property">clientHeight</span>; <span class="comment">//canvas画布高度</span></span><br><span class="line">   <span class="keyword">const</span> k = width / height; <span class="comment">//canvas画布宽高比</span></span><br><span class="line">   <span class="keyword">const</span> s = <span class="number">5</span>;<span class="comment">//控制left, right, top, bottom范围大小</span></span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(k*s,<span class="string">&#x27;ks&#x27;</span>);</span><br><span class="line">   <span class="keyword">const</span> camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">OrthographicCamera</span>(-k*s,k*s,s,-s,<span class="number">0.001</span>,<span class="number">8000</span>)</span><br><span class="line">camera.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">10</span>,<span class="number">10</span>,<span class="number">10</span>)</span><br><span class="line">   camera.<span class="title function_">lookAt</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">   scene.<span class="title function_">add</span>(camera)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> depth = <span class="number">0.2</span><span class="comment">//地图的深度</span></span><br><span class="line">   <span class="comment">//生成区县模块以及区县的边框</span></span><br><span class="line">   cq.<span class="title function_">map</span>(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">       <span class="keyword">let</span> v2 = []</span><br><span class="line">       <span class="keyword">let</span> v3 = []</span><br><span class="line">       item.<span class="property">path</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">el</span> =&gt;</span> &#123;</span><br><span class="line">           v2.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(el[<span class="number">0</span>],el[<span class="number">1</span>]))</span><br><span class="line">           v3.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(el[<span class="number">0</span>],el[<span class="number">1</span>],depth+<span class="number">0.0001</span>))</span><br><span class="line">       &#125;);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">let</span> shape = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Shape</span>(v2)</span><br><span class="line">       <span class="keyword">let</span> <span class="title class_">ShapeGeo</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">ExtrudeGeometry</span>(shape,&#123;<span class="attr">depth</span>:depth,<span class="attr">curveSegments</span>:v3.<span class="property">length</span>,<span class="attr">bevelEnabled</span>:<span class="literal">false</span>&#125;)</span><br><span class="line">       <span class="keyword">let</span> shapeMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshPhongMaterial</span>(&#123;<span class="attr">color</span>:<span class="string">&#x27;#0a4287&#x27;</span>,<span class="attr">opacity</span>:<span class="number">1</span>&#125;)</span><br><span class="line">       <span class="keyword">let</span> shapeMaterial2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshPhongMaterial</span>(&#123;<span class="attr">color</span>:<span class="string">&#x27;#1b6ef3&#x27;</span>,<span class="attr">opacity</span>:<span class="number">1</span>&#125;)</span><br><span class="line">       <span class="keyword">let</span> shaeMesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(<span class="title class_">ShapeGeo</span>,[shapeMaterial,shapeMaterial2])</span><br><span class="line">       shaeMesh.<span class="property">position</span>.<span class="property">z</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">       <span class="keyword">const</span> areaLineGeo = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferGeometry</span>().<span class="title function_">setFromPoints</span>(v3)</span><br><span class="line">       <span class="keyword">const</span> areaLineMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshPhongMaterial</span>(&#123;<span class="attr">color</span>:<span class="string">&#x27;#fff&#x27;</span>,&#125;)</span><br><span class="line">       <span class="keyword">const</span> areaLine = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Line</span>(areaLineGeo,areaLineMaterial)</span><br><span class="line">       <span class="variable language_">console</span>.<span class="title function_">log</span>(shaeMesh);</span><br><span class="line">       scene.<span class="title function_">add</span>(areaLine)</span><br><span class="line">       scene.<span class="title function_">add</span>(shaeMesh)</span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(cqoutLine);</span><br><span class="line">   <span class="comment">//创建一个重庆地图轮廓 以便于让地图居中</span></span><br><span class="line">   <span class="keyword">let</span> outLine = []</span><br><span class="line">   cqoutLine.<span class="property">features</span>[<span class="number">0</span>].<span class="property">geometry</span>.<span class="property">coordinates</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">       <span class="variable language_">console</span>.<span class="title function_">log</span>(item);      </span><br><span class="line">       item[<span class="number">0</span>].<span class="title function_">forEach</span>(<span class="function"><span class="params">val</span>=&gt;</span>&#123;</span><br><span class="line">           outLine.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(val[<span class="number">0</span>],val[<span class="number">1</span>],depth+<span class="number">0.0001</span>))</span><br><span class="line">       &#125;)</span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(outLine,<span class="string">&#x27;新&#x27;</span>);</span><br><span class="line">   <span class="keyword">const</span> outLineGeo = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferGeometry</span>().<span class="title function_">setFromPoints</span>(outLine)</span><br><span class="line">   <span class="keyword">const</span> outLIneMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;<span class="attr">color</span>:<span class="string">&#x27;red&#x27;</span>&#125;)</span><br><span class="line">   <span class="keyword">const</span> outLineMesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Line</span>(outLineGeo,outLIneMaterial)</span><br><span class="line">   <span class="comment">// scene.add(outLineMesh)</span></span><br><span class="line">   <span class="comment">//包围盒 通过包围盒获取到物体的中心点</span></span><br><span class="line">   camera.<span class="title function_">lookAt</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">   camera.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">300</span>,<span class="number">300</span>,<span class="number">300</span>)</span><br><span class="line">   <span class="keyword">const</span> mapBox = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Box3</span>()</span><br><span class="line">   <span class="keyword">let</span> outLineBox = mapBox.<span class="title function_">expandByObject</span>(outLineMesh)</span><br><span class="line">   <span class="keyword">const</span> center = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>() <span class="comment">//获取地图中心点</span></span><br><span class="line">   outLineBox.<span class="title function_">getCenter</span>(center)</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(center,<span class="string">&#x27;center&#x27;</span>);</span><br><span class="line">   <span class="comment">//重新设置相机的观察中心点以及相机的位置。</span></span><br><span class="line">   camera.<span class="title function_">lookAt</span>(center.<span class="property">x</span>,center.<span class="property">y</span>,center.<span class="property">z</span>)</span><br><span class="line">   camera.<span class="property">position</span>.<span class="title function_">set</span>(center.<span class="property">x</span>,center.<span class="property">y</span>,<span class="number">50</span>)</span><br><span class="line">   <span class="comment">//重新设置轨道控制器的中心点。需要手动update一下配置</span></span><br><span class="line">   <span class="title class_">Controls</span>.<span class="property">target</span>.<span class="title function_">set</span>(center.<span class="property">x</span>,center.<span class="property">y</span>,center.<span class="property">z</span>);</span><br><span class="line">   <span class="title class_">Controls</span>.<span class="title function_">update</span>();</span><br><span class="line">   <span class="keyword">let</span> mapBoxSize = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>()<span class="comment">//获取地图包围盒的大小</span></span><br><span class="line">   outLineBox.<span class="title function_">getSize</span>(mapBoxSize)</span><br><span class="line">   <span class="keyword">const</span> obj = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Object3D</span>()</span><br><span class="line">   obj.<span class="property">position</span>.<span class="title function_">set</span>(center.<span class="property">x</span>,center.<span class="property">y</span>,center.<span class="property">z</span>)</span><br><span class="line">   cqLight.<span class="property">target</span> = obj</span><br></pre></td></tr></table></figure>



<img src="img/three/1713348789513.png" alt="1713348789513" style="zoom:67%;" />



<p><strong>相机的动画效果：</strong></p>
<p>主要是通过移动相机的position 完成的。</p>
<p>如在animation中不断更新相机的位置，相机观察的中心点始终为某个点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function animation()&#123;</span><br><span class="line"></span><br><span class="line">	ridius+=0.001</span><br><span class="line"></span><br><span class="line">   camera.position.z = r * Math.sin(ridius)</span><br><span class="line"></span><br><span class="line">   camera.position.x = r * Math.cos(ridius)</span><br><span class="line"></span><br><span class="line">   camera.position.x += 0.003</span><br><span class="line"></span><br><span class="line">   camera.position.z -= 0.003</span><br><span class="line"></span><br><span class="line">   camera.lookAt(5,1.2,-5)</span><br><span class="line"></span><br><span class="line">   renderer.render(scene,camera)</span><br><span class="line"></span><br><span class="line">   requestAnimationFrame(animation)</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> animation()</span><br></pre></td></tr></table></figure>

<p>相机的**.up**属性控制哪个坐标轴朝上：</p>
<p>x轴朝上：camera.up.set(1,0,0)</p>
<p>y轴朝上：camera.up.set(0,1,0)</p>
<p>z轴朝上：camera.up.set(0,0,1)</p>
<h6 id="管道穿梭案例："><a href="#管道穿梭案例：" class="headerlink" title="管道穿梭案例："></a>管道穿梭案例：</h6><p>思路创建一个曲线，生成对应的管道模型。获取这个曲线上的点，相机位置设置在第当前点位上 然后相机的朝向为当前点位的下一个点的位置。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//相机选择透视相机，相机的仰角调试大一点管道中看的更多。45设置为90</span></span><br><span class="line">cosnt coverLine = <span class="keyword">new</span> three.<span class="title class_">CubicBezierCurve3</span>(</span><br><span class="line">	<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>( -<span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span> ),</span><br><span class="line">	<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>( -<span class="number">5</span>, <span class="number">15</span>, <span class="number">0</span> ),</span><br><span class="line">	<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>( <span class="number">20</span>, <span class="number">15</span>, <span class="number">0</span> ),</span><br><span class="line">	<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>( <span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span> )</span><br><span class="line">)</span><br><span class="line"><span class="comment">//创建纹理</span></span><br><span class="line"><span class="keyword">const</span> textrue = <span class="keyword">new</span> three.<span class="title class_">TextrueLoader</span>().<span class="title function_">load</span>(<span class="string">&#x27;water.png&#x27;</span>)</span><br><span class="line">textrue.<span class="property">warpS</span> = three.<span class="property">RepeatWrapping</span> <span class="comment">//开启矩阵模式 水平平铺</span></span><br><span class="line">textrue.<span class="property">repeate</span>.<span class="property">x</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> coverMaterial = <span class="keyword">new</span> three.<span class="title class_">MeshBasicMaterial</span>(&#123;</span><br><span class="line">    <span class="attr">map</span>:textrue,</span><br><span class="line">    <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>，<span class="comment">//双面显示</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取曲线上的点</span></span><br><span class="line"><span class="keyword">const</span> coverPoints = coverLine.<span class="title function_">getPoints</span>(<span class="number">500</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> i = <span class="number">0</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">animation</span>(<span class="params"></span>)&#123;</span><br><span class="line">	i+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span>(i &lt; coverPoints.<span class="property">length</span> - <span class="number">1</span>)&#123;</span><br><span class="line">    	camera.<span class="property">position</span>.<span class="title function_">copy</span>(coverPoints[i])<span class="comment">//相机位置在当前项</span></span><br><span class="line">        camera.<span class="title function_">lookAt</span>(coverPoints[i + <span class="number">1</span>])<span class="comment">//相机朝向下一项</span></span><br><span class="line">     &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">     &#125;</span><br><span class="line">    renderer.<span class="title function_">render</span>(scene,camera)</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(animation)</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">animation</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h6 id="相机控件OrbitControls"><a href="#相机控件OrbitControls" class="headerlink" title="相机控件OrbitControls"></a>相机控件OrbitControls</h6><ul>
<li>旋转：拖动鼠标左键。<code>enableRotate</code>:true 开启旋转</li>
<li>缩放：滚动鼠标中键。 <code>enableZoom</code> ：true 开启缩放</li>
<li>平移：拖动鼠标右键 。<code>enablePan</code>：true 开启平移</li>
</ul>
<p>设置控件的平移，缩放，旋转就是控制相机的位置变化。</p>
<p>如果修改了空间的target的目标点 则也修改了相机的camera。修改控件的属性时也需要更新控件update()</p>
<p><strong>控制缩放范围:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">透视投影相机看见为物体效果问近大远小，控件提供了两个属性minDistance 与 maxDistance, </span><br><span class="line">controls.minDistance = 5</span><br><span class="line">controls.maxDistance = 15</span><br><span class="line"></span><br><span class="line">正投影相机则是minZoom,maxZoom </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>控制相机的旋转范围：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">控制相机旋转范围：</span><br><span class="line">	minPolarAngle / maxPolarAngle 控制相机的上下旋转范围</span><br><span class="line">    controls.minPolarAngle = 0 </span><br><span class="line">    controls.maxPolarAngle = Math.PI / 4</span><br><span class="line">    </span><br><span class="line">    minAzimuthAngle / maxAzimuthAngle 控制相机左右旋转范围</span><br><span class="line">    controls.minAzimuthAngle = 0</span><br><span class="line">    controls.maxAzimuthAngle = Math.PI /2</span><br></pre></td></tr></table></figure>

<p>除了OrbitControls控件外 还有一个MapOrbitControls 模拟地图的拖拽。</p>
<h3 id="光源-light"><a href="#光源-light" class="headerlink" title="光源:light"></a>光源:light</h3><p>光源基类light:平行光：DirectionalLight  点光源：PointLight  聚光灯：SpotLight ；这光源三种都能产生阴影。</p>
<p>环境光源：AmbientLight 。不会产生阴影</p>
<p><strong>调试注意：</strong>调试阴影的时候记得开启相机的辅助工具 以便快速找到相机的范围; 以及将光源可视化确定光源的具体位置。</p>
<p><strong>光源如何产生阴影：</strong></p>
<p>1.光源需要设置.castShadow 为true</p>
<p>2.产生阴影的模型需要设置.castShadow 为true</p>
<p>3.渲染器的允许渲染 renderder. shadowMap.enabled  为true</p>
<p>4.设置渲染范围.shadow.camera  属性值始终为正投影相机OrthographicCamera , 限制阴影的范围，如果给的不合适看不到或者看不全，模糊不清等</p>
<p><strong>光源的shadow.mapSize</strong></p>
<p>提高阴影的渲染效果，值越大越清楚。默认值512</p>
<p><img src="/img/three/1713778296664.png" alt="1713778296664"></p>
<p><strong>注意：</strong></p>
<p>在能覆盖包含阴影渲染范围的情况下, .shadow.camera的尺寸尽量小。</p>
<p>如果你增加.shadow.camera的长方体视野尺寸范围,阴影模糊齿感,可以适当提升.shadow.mapSize的大小。</p>
<p><strong>光源的shadow.radius</strong></p>
<p>改变阴影边缘的过度效果。</p>
<p>可以适当的提升.shadow.radius让边缘的过度效果更明显。或者说边缘逐渐弱化或者模糊化，没有明显的边界干。</p>
<img src="img/three/1713778832957.png" alt="1713778832957" style="zoom:67%;" />

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//光</span></span><br><span class="line">   <span class="comment">// 设置渲染器，允许光源阴影渲染</span></span><br><span class="line">   renderer.<span class="property">shadowMap</span>.<span class="property">enabled</span> = <span class="literal">true</span>; </span><br><span class="line">   <span class="keyword">const</span> light = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AmbientLight</span>( <span class="number">0x404040</span>,<span class="number">10</span> ); <span class="comment">// 柔和的白光</span></span><br><span class="line">   <span class="keyword">const</span> gui = <span class="keyword">new</span> <span class="title function_">GUI</span>();<span class="comment">//创建GUI对象 </span></span><br><span class="line">   gui.<span class="title function_">add</span>(light, <span class="string">&#x27;intensity&#x27;</span>, <span class="number">0</span>, <span class="number">100</span>).<span class="title function_">name</span>(<span class="string">&#x27;环境光.intensity&#x27;</span>);</span><br><span class="line">   scene.<span class="title function_">add</span>( light );</span><br><span class="line">   <span class="comment">//平行光</span></span><br><span class="line">   <span class="keyword">const</span> directionalLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">DirectionalLight</span>( <span class="number">0xffffff</span>,<span class="number">5</span>)</span><br><span class="line">   directionalLight.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">100</span>,<span class="number">100</span>,<span class="number">100</span>),</span><br><span class="line">   directionalLight.<span class="property">target</span>.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">   directionalLight.<span class="property">castShadow</span> = <span class="literal">true</span></span><br><span class="line">   directionalLight.<span class="property">receiveShadow</span> = <span class="literal">true</span>;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;阴影相机属性&#x27;</span>,directionalLight.<span class="property">shadow</span>.<span class="property">camera</span>);</span><br><span class="line">   <span class="keyword">const</span> directionalLightHelp = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">DirectionalLightHelper</span>(directionalLight,<span class="number">0xffffff</span>)</span><br><span class="line">   directionalLight.<span class="property">shadow</span>.<span class="property">mapSize</span>.<span class="title function_">set</span>(<span class="number">2540</span>,<span class="number">2540</span>) <span class="comment">//边缘的颗粒度</span></span><br><span class="line">   directionalLight.<span class="property">shadow</span>.<span class="property">radius</span> = <span class="number">5</span></span><br><span class="line">   directionalLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">left</span> = -<span class="number">100</span>;</span><br><span class="line">   directionalLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">right</span> = <span class="number">100</span>;</span><br><span class="line">   directionalLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">top</span> = <span class="number">100</span>;</span><br><span class="line">   directionalLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">bottom</span> = -<span class="number">100</span>;</span><br><span class="line">   directionalLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">near</span> = <span class="number">0.01</span>;</span><br><span class="line">   directionalLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">far</span> = <span class="number">5000</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// scene.add(directionalLightHelp)</span></span><br><span class="line">   <span class="comment">// 可视化平行光阴影对应的正投影相机对象</span></span><br><span class="line">   <span class="keyword">const</span> cameraHelper = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CameraHelper</span>(directionalLight.<span class="property">shadow</span>.<span class="property">camera</span>);</span><br><span class="line">   scene.<span class="title function_">add</span>(cameraHelper);</span><br><span class="line">   <span class="comment">// 可视化平行光</span></span><br><span class="line">   <span class="keyword">const</span> dirHelper = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">DirectionalLightHelper</span>( directionalLight, <span class="number">5</span>);</span><br><span class="line">   scene.<span class="title function_">add</span>( dirHelper );</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> load = <span class="keyword">new</span> <span class="title class_">GLTFLoader</span>(<span class="string">&#x27;模型1.gltf&#x27;</span>,<span class="function"><span class="params">gltf</span>=&gt;</span>&#123;</span><br><span class="line">       gltf.<span class="property">scene</span>.<span class="property">castShadow</span> = <span class="literal">true</span> </span><br><span class="line">       scene.<span class="title function_">add</span>(gltf.<span class="property">scene</span>)</span><br><span class="line">   &#125;)</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">  <span class="comment">// gui调节阴影</span></span><br><span class="line">   <span class="comment">// 阴影子菜单</span></span><br><span class="line">   <span class="keyword">const</span> shadowFolder = gui.<span class="title function_">addFolder</span>(<span class="string">&#x27;平行光阴影&#x27;</span>);</span><br><span class="line">   <span class="keyword">const</span> cam = directionalLight.<span class="property">shadow</span>.<span class="property">camera</span>;</span><br><span class="line">   <span class="comment">// 相机left、right等属性变化执行.updateProjectionMatrix();</span></span><br><span class="line">   <span class="comment">// 相机变化了，执行CameraHelper的更新方法.update();</span></span><br><span class="line">   shadowFolder.<span class="title function_">add</span>(cam,<span class="string">&#x27;left&#x27;</span>,-<span class="number">500</span>,<span class="number">0</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span>(<span class="params">v</span>)&#123;</span><br><span class="line">       cam.<span class="title function_">updateProjectionMatrix</span>();<span class="comment">//相机更新投影矩阵</span></span><br><span class="line">       cameraHelper.<span class="title function_">update</span>();<span class="comment">//相机范围变化了，相机辅助对象更新</span></span><br><span class="line">   &#125;);</span><br><span class="line">   shadowFolder.<span class="title function_">add</span>(cam,<span class="string">&#x27;right&#x27;</span>,<span class="number">0</span>,<span class="number">500</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span>(<span class="params">v</span>)&#123;</span><br><span class="line">       cam.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">       cameraHelper.<span class="title function_">update</span>();</span><br><span class="line">   &#125;);</span><br><span class="line">   shadowFolder.<span class="title function_">add</span>(cam,<span class="string">&#x27;top&#x27;</span>,<span class="number">0</span>,<span class="number">500</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span>(<span class="params">v</span>)&#123;</span><br><span class="line">       cam.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">       cameraHelper.<span class="title function_">update</span>();</span><br><span class="line">   &#125;);</span><br><span class="line">   shadowFolder.<span class="title function_">add</span>(cam,<span class="string">&#x27;bottom&#x27;</span>,-<span class="number">500</span>,<span class="number">0</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span>(<span class="params">v</span>)&#123;</span><br><span class="line">       cam.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">       cameraHelper.<span class="title function_">update</span>();</span><br><span class="line">   &#125;);</span><br><span class="line">   shadowFolder.<span class="title function_">add</span>(cam,<span class="string">&#x27;far&#x27;</span>,<span class="number">0</span>,<span class="number">1000</span>).<span class="title function_">onChange</span>(<span class="keyword">function</span>(<span class="params">v</span>)&#123;</span><br><span class="line">       cam.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">       cameraHelper.<span class="title function_">update</span>();</span><br><span class="line">   &#125;);</span><br><span class="line"><span class="comment">// *做一个太阳的升起与降落：原理光源在绕着z轴进行旋转</span></span><br><span class="line"><span class="keyword">let</span> r = <span class="number">100</span> <span class="comment">//光源旋转半径</span></span><br><span class="line">   <span class="keyword">let</span> angle = <span class="number">0</span> <span class="comment">//光源的角度</span></span><br><span class="line">   <span class="keyword">function</span> <span class="title function_">animation</span>(<span class="params"></span>)&#123;</span><br><span class="line">       angle+=<span class="number">0.01</span></span><br><span class="line">   	directionalLight.<span class="property">position</span>.<span class="property">y</span> = r * <span class="title class_">Math</span>.<span class="title function_">sin</span>(angle)    </span><br><span class="line">       directionalLight.<span class="property">position</span>.<span class="property">x</span> = r * <span class="title class_">Math</span>.<span class="title function_">cos</span>(angle) </span><br><span class="line">       </span><br><span class="line">      	renderer.<span class="title function_">render</span>(scene,camera)</span><br><span class="line">       <span class="title function_">requestAnimationFrame</span>(animation)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="精灵：sprite"><a href="#精灵：sprite" class="headerlink" title="精灵：sprite"></a>精灵：sprite</h3><p>spriteMaterial:材质与普通网格材质一样可以设置相关的.map envMap 啥的。</p>
<p><strong>Sprite</strong>:<strong>始终朝向摄像机，旋转轨道也不会让精灵图旋转</strong>，<strong>不会产生阴影</strong>。即使设置了castShadow为true也不会生效。与其他材质不同的是精灵不需要设置几何体 Geometry ，精灵图的默认尺寸都是 1 ，</p>
<p>透视相机中：也遵循远小近大的原理</p>
<p>正投影相机如何验证精灵的尺寸：如果精灵尺寸为1， 给相机top , buttom设置为0.5 则整个精灵回撑满画布。</p>
<p><strong>精灵与矩形mesh区别</strong>：他们都是一个矩形，区别在于精灵始终平行于画布，而mesh的矩形则始终跟着旋转。在尺寸上，mesh可以通过geometry和mesh.scale来定义，然而精灵则只能通过sprite.scale来定义。</p>
<p><strong>模拟下雨和下雪的效果：</strong>如果要做下雨效果3d的曲面几何体，一个曲面几何体需要4个三角形的话，如果有3千个水滴，则需要3万个三角形；如果用精灵的话，一个精灵只需要两个三角形，减少了很多三角形的生成。渲染性能要好很多。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const texture = new THREE.TextureLoader().load(&#x27;img/wa3.jpg&#x27;)</span></span><br><span class="line"><span class="keyword">const</span> texture = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>().<span class="title function_">load</span>(<span class="string">&#x27;img/xue.png&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> spriteMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SpriteMaterial</span>(&#123;</span><br><span class="line">    <span class="attr">map</span>:texture,</span><br><span class="line">    <span class="comment">// rotation:Math.PI/4,//旋转精灵对象45度，弧度值</span></span><br><span class="line">    <span class="attr">transparent</span>:<span class="literal">true</span>,<span class="comment">//SpriteMaterial默认是true</span></span><br><span class="line">    &#125;)</span><br><span class="line"><span class="keyword">const</span> group = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Object3D</span>()</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>;i &lt; <span class="number">6000</span>;i++)&#123;</span><br><span class="line">    <span class="keyword">const</span> sprite = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Sprite</span>(spriteMaterial)</span><br><span class="line">    sprite.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">5</span>, <span class="number">5</span>, <span class="number">1</span>)</span><br><span class="line">    sprite.<span class="property">position</span>.<span class="property">x</span> = <span class="number">500</span> * (<span class="title class_">Math</span>.<span class="title function_">random</span>() - <span class="number">0.5</span>)</span><br><span class="line">    sprite.<span class="property">position</span>.<span class="property">y</span> = <span class="number">250</span> * (<span class="title class_">Math</span>.<span class="title function_">random</span>())</span><br><span class="line">    sprite.<span class="property">position</span>.<span class="property">z</span> = <span class="number">500</span> * (<span class="title class_">Math</span>.<span class="title function_">random</span>() - <span class="number">0.5</span>)</span><br><span class="line">    group.<span class="title function_">add</span>(sprite)</span><br><span class="line">&#125;</span><br><span class="line">scene.<span class="title function_">add</span>(group)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clock = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Clock</span>()</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loop</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// 通过tranvers来循环修改比较卡</span></span><br><span class="line">    <span class="comment">// group.traverse(item=&gt;&#123;</span></span><br><span class="line">    <span class="comment">//     console.log(item,&#x27;w&#x27;);</span></span><br><span class="line">    <span class="comment">//     item.position.y -=0.1</span></span><br><span class="line">    <span class="comment">//     if(item.position.y&lt;0)&#123;</span></span><br><span class="line">    <span class="comment">//         item.position.y = 100</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据时间来设置相关位置 很卡</span></span><br><span class="line">    <span class="comment">// const t = clock.getDelta();// loop()两次执行时间间隔</span></span><br><span class="line">    <span class="comment">// group.children.forEach(item=&gt;&#123;</span></span><br><span class="line">    <span class="comment">//     console.log(t);</span></span><br><span class="line">    <span class="comment">//     item.position.y -= t * 60</span></span><br><span class="line">    <span class="comment">//     if(item.position.y &lt; 0)&#123;</span></span><br><span class="line">    <span class="comment">//         item.position.y = 100</span></span><br><span class="line">    <span class="comment">//      &#125;</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 周期性改变雨滴位置</span></span><br><span class="line">    group.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">//近点的雨滴 雪比较大 可以将相机的近点参数设置到一点</span></span><br><span class="line">        item.<span class="property">position</span>.<span class="property">y</span> -= <span class="number">0.1</span></span><br><span class="line">        item.<span class="property">material</span>.<span class="property">rotation</span> += <span class="number">0.000001</span><span class="comment">// 雪花旋转需要旋转材质中的rotation</span></span><br><span class="line">        <span class="keyword">if</span>(item.<span class="property">position</span>.<span class="property">y</span> &lt; <span class="number">0</span>)&#123;</span><br><span class="line">            item.<span class="property">position</span>.<span class="property">y</span> = <span class="number">250</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(loop)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">loop</span>()</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">animation</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">    renderer.<span class="title function_">render</span>(scene,camera)</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(animation)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">animation</span>()</span><br></pre></td></tr></table></figure>



<h3 id="后处理：-EffectComposer"><a href="#后处理：-EffectComposer" class="headerlink" title="后处理： EffectComposer"></a>后处理： EffectComposer</h3><p><strong>定义：</strong>可以理解为处理照片后期处理一个 ‘ps’。</p>
<p>这是一个拓展库需要单独引入EffectComposer.js 和相关的后期处理通道。</p>
<p>后期处理库：</p>
<ul>
<li><code>OutlinePass.js</code>：高亮发光描边</li>
<li><code>UnrealBloomPass.js</code>：Bloom发光</li>
<li><code>GlitchPass.js</code>：画面抖动效果</li>
<li>GammaCorrectionShader 伽马矫正</li>
</ul>
<p>…等，通道可以组合使用：组合使用的话，先处理一个通道再处理另外一个。</p>
<p> threejs本地部署的服务文件包examples文件目录，全文检索关键词<code>EffectComposer</code>，可以找到后处理的很多案例。 </p>
<p><strong>设置后期处理后，模型会出现色差， renderer.outputEncoding色彩空间不会生效，此时我们需要设置伽马校正通道。GammaCorrectionShader.js 提供了伽马校正的对象，可以处理模型后处理后颜色的色彩。没有伽马矫正的通道 还需要引入一个shaderPass.js库 配合使用 将伽马校正的对象作为参数创建校验通道。</strong></p>
<p><img src="/img/three/1714356663966.png" alt="1714356663966"></p>
<p>模型添加后会出现锯齿：后处理器多种抗锯齿配置， FXAAShader 和 SMAAShader。SMAA效果比FXAA的效果好写</p>
<p>如何使用呢：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">   import &#123; EffectComposer &#125; from &#x27;three/addons/postprocessing/EffectComposer.js&#x27;;</span><br><span class="line">   import &#123; RenderPass &#125; from &#x27;three/addons/postprocessing/RenderPass.js&#x27;;//渲染器通道RenderPass</span><br><span class="line">   import &#123; OutlinePass &#125; from &#x27;three/addons/postprocessing/OutlinePass.js&#x27;;//物体模型外描边通道RenderPass</span><br><span class="line">   import &#123; UnrealBloomPass &#125; from &#x27;three/addons/postprocessing/UnrealBloomPass.js&#x27;;// 引入UnrealBloomPass通道</span><br><span class="line">// 引入GlitchPass通道 </span><br><span class="line">   import &#123; GlitchPass &#125; from &#x27;three/addons/postprocessing/GlitchPass.js&#x27;;</span><br><span class="line"></span><br><span class="line">// 伽马校正后处理Shader</span><br><span class="line">   import &#123;GammaCorrectionShader&#125; from &#x27;three/addons/shaders/GammaCorrectionShader.js&#x27;;</span><br><span class="line">       // ShaderPass功能：使用后处理Shader创建后处理通道</span><br><span class="line">   import &#123;ShaderPass&#125; from &#x27;three/addons/postprocessing/ShaderPass.js&#x27;;</span><br><span class="line">   // FXAA抗锯齿Shader</span><br><span class="line">   import &#123; FXAAShader &#125; from &#x27;three/addons/shaders/FXAAShader.js&#x27;;</span><br><span class="line">   // SMAA抗锯齿通道</span><br><span class="line">   import &#123;SMAAPass&#125; from &#x27;three/addons/postprocessing/SMAAPass.js&#x27;;</span><br><span class="line"></span><br><span class="line">   //首先需要使用后期处理器</span><br><span class="line">   const composer = new EffectComposer(renderder) //参数为需要处理的webgl渲染器</span><br><span class="line"></span><br><span class="line">   //创建渲染器通道。这个必须要有不然后面可能不会出现效果</span><br><span class="line">   const renderPass = new RenderPass(scene,camera)//参数为场景与相机</span><br><span class="line">   comporser.addPass(renderPass)//给后期处理器添加渲染器通道</span><br><span class="line">   //例子 物体的外边缘发光通道</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   //创建一个二维矢量 大小与画布一直</span><br><span class="line">   let v2 = new three.Vector2(canvas.innerWidth,canvas.innerHeight)</span><br><span class="line">   const outLinePass = new OutlinePass(v2,scene,camera)</span><br><span class="line">   outLinePass.selectedObjects = [mesh1] //selectedObjects属性为添加物体 值为数组所以可以添加多个</span><br><span class="line">   composer.addPass(outLinePass)</span><br><span class="line"></span><br><span class="line">   //outLinePass的相关属性</span><br><span class="line">   outLinePass.visibleEdgeColor.set(0xffff00) //控制描边的颜色</span><br><span class="line">   outLinePass.edgeThickness = 4 //描边的厚度</span><br><span class="line">   outLinePass.edgeStrength = 6 //描边的亮度</span><br><span class="line">   outLinePass.pulsPeriod = 2 //描边的闪烁频率</span><br><span class="line"></span><br><span class="line">   const bloom = new UnrealBloomPass(v2) //控制物体本身发光</span><br><span class="line">   bloom.strength = 2 //发光强度</span><br><span class="line">   // composer.addPass(bloom)</span><br><span class="line">   </span><br><span class="line">	const glitchPass = new GlitchPass()//闪屏效果，类型以前黑白电视信号不好的闪屏</span><br><span class="line">   composer.addPass(glitchPass)</span><br><span class="line">   </span><br><span class="line">   // 创建伽马校正通道</span><br><span class="line">   const gammaPass= new ShaderPass(GammaCorrectionShader);</span><br><span class="line">   composer.addPass(gammaPass);</span><br><span class="line">   	</span><br><span class="line">   //首先需要设置像素比，避免canvas画布数据模糊</span><br><span class="line">   renderer.setPixelRatio(window.devicePixelRatio);</span><br><span class="line">   const pixelRatio = renderer.getPixelRatio()</span><br><span class="line">   console.log(pixelRatio,&#x27;像素比&#x27;);</span><br><span class="line">   </span><br><span class="line">	//FXAA抗锯齿</span><br><span class="line">   const fxaa = new ShaderPass(FXAAShader)</span><br><span class="line">   fxaa.uniforms.resolution.value.x = 1/(canvas.clientWidth*pixelRatio)</span><br><span class="line">   fxaa.uniforms.resolution.value.y = 1/(canvas.clientHeight*pixelRatio)</span><br><span class="line">   // composer.addPass(fxaa) </span><br><span class="line">   </span><br><span class="line">   //smaa抗锯齿</span><br><span class="line">   const smaa = new 	  SMAAPass(canvas.clientWidth*pixelRatio,canvas.clientHeight*pixelRatio)</span><br><span class="line">   composer.addPass(smaa)</span><br><span class="line">   </span><br><span class="line">//还需要设循环渲染中调用一下后期渲染器 后期渲染器执行时也可以不用执行webgl渲染器的渲染了</span><br><span class="line">   function animation()&#123;</span><br><span class="line">       //renderer.render(scene,camera)</span><br><span class="line">       composer.render()</span><br><span class="line">       requestAnimationFrame(animation)</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   animation()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="射线Ray（重点）"><a href="#射线Ray（重点）" class="headerlink" title="射线Ray（重点）"></a>射线Ray（重点）</h3><p>射线起点：<code>origin</code>为一个三维向量</p>
<p>射线方向：<code>direction</code> 是一个三维向量单位，向量长度始终为1，在设置了三维向量后我们一般使用 .normalize() 将其向量进行归一化。归一化就是将这个线长度变为1。</p>
<p><strong>射线的真实方向：</strong>射线方向归一后，得到的方向就是射线的防线，简单点来说我们将射线方向起点移动到射线起点就会得到射线的真实方向了。</p>
<p>intersectObjects(meshArr):与哪些物体相交。注意点：我们在执行这个方法前先更新一下坐标，因为修改了相关位置信息后会在下一次render时才生效，所以我们得updateMatrixWorld()手动更新.</p>
<p><img src="/img/three/1714375185358.png" alt="1714375185358"><img src="/img/three/1714375233084.png" alt="1714375233084"></p>
<p><strong>屏幕坐标转three.js设备坐标：</strong>我们可以用offset与client来进行转换，两种坐标点转换逻辑其实都差不多。<strong>设备作标</strong>以canvas中心点为坐标原点，xy坐标的范围在[-1,1]。</p>
<p><strong>计算逻辑：</strong>设备坐标范围[-1,1]，所以我们需要一个范围。首先求出每个方向上的占比，此时得到的就是一个小于1</p>
<p>的小数。因为-1 到 1范围是2 ,所以得到的值乘2，再-1 结果永远都在 - 1 跟 1 之间了。唯一注意点是y轴方向相反 ，占比值取负*2 + 1。</p>
<p><strong>offset转换</strong>：建议</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//获取canvas画布的宽高 width,height</span><br><span class="line">let x = (width/e.offsetX) * 2 - 1 </span><br><span class="line">let y = -(height/e.offsetY)*2 + 1</span><br></pre></td></tr></table></figure>

<p><strong>client转换</strong>：需要注意的是，client坐标是相对浏览器的，所以canvas画布距离浏览器上边与左边的距离需要自己删减一波，如果开全屏的画就不需要了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">let</span> canvasWidth = canvas.<span class="property">clientWidth</span></span><br><span class="line">   <span class="keyword">let</span> canvasHeight = canvas.<span class="property">clientHeight</span></span><br><span class="line"><span class="comment">// 用client坐标转换设备坐标</span></span><br><span class="line">   <span class="keyword">let</span> cX = ((e.<span class="property">clientX</span> - <span class="number">8</span>)/canvasWidth) * <span class="number">2</span> - <span class="number">1</span></span><br><span class="line">   <span class="keyword">let</span> cY = -((e.<span class="property">clientY</span>-<span class="number">20.8</span>-<span class="number">8</span>)/canvasHeight) * <span class="number">2</span> +<span class="number">1</span></span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(cX,cY,<span class="string">&#x27;client&#x27;</span>);</span><br><span class="line">   <span class="comment">//全屏</span></span><br><span class="line">   <span class="keyword">let</span> cX = (e.<span class="property">clientX</span>/canvasWidth) * <span class="number">2</span> - <span class="number">1</span></span><br><span class="line">   <span class="keyword">let</span> cY = -(e.<span class="property">clientY</span>/canvasHeight) * <span class="number">2</span> + <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/three/1714442633565.png" alt="1714442633565"></p>
<p><strong>射线拾取器Raycaster：</strong>创建Raycaster实例。他的ray属性就是射线，设置ray的origin,direction就是改变射线拾取器的起点与方向，也可以通过拾取器的Set方法来进行修改。</p>
<p>.intersectObject( mesh )：方法 判断是否包含某个物体</p>
<p>.intersectObjects( [ mesh1,  mesh2 ] )：检索是否经过这些物体，将经过的物体返回成一个数组，没有就是空数组</p>
<p>.setFromCamera( v2 , camera) :  v2作为方向， 在标准化设备坐标中鼠标的二维坐标 —— X分量与Y分量应当在-1到1之间。 射线所来源的摄像机。</p>
<p>.set(v3,direction): v3 作为起点，是个三维坐标。direction是一个方向也是三维坐标。</p>
<p><strong>如果画布容器canvas尺寸发生变化，需要更新的设置</strong>：相机的宽高比需要更新camera.aspect&#x3D;w&#x2F;h ; 渲染器更新画布尺寸render.setSize(w,h) ; 相机参数变化，相机必须更新camera.updateProjectionMatrix();</p>
<p>精灵图也可以进行拾取，操作方法与mesh一样的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">const</span> ray = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Ray</span>()</span><br><span class="line">    ray.<span class="property">origin</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">    <span class="comment">// ray.direction = new THREE.Vector3(5,5,5).normalize()</span></span><br><span class="line">    ray.<span class="property">direction</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>).<span class="title function_">normalize</span>();</span><br><span class="line">    <span class="comment">//数据归一化 将向量转化为方向向量 向量的长度变为1</span></span><br><span class="line">    <span class="comment">// let L = ray.direction.length() </span></span><br><span class="line">    <span class="comment">// ray.direction.multiplyScalar(1/L) //multiplyScalar将该方向的三维向量归一化 1除向量的长度得到这个比例，然后xyz三个点都会乘以这个值。</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//判断射线是否相交某个三角形.intersectTriangle(v1,v2,v3,backfaceCulling:boolean,target) 相交时将值付给target.</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//通过坐标拾取器来获取鼠标交互的模型</span></span><br><span class="line">	<span class="keyword">const</span> raycaster = <span class="keyword">new</span> <span class="title class_">Raycaster</span>()</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="function"><span class="params">e</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> canvasWidth = canvas.<span class="property">clientWidth</span></span><br><span class="line">        <span class="keyword">let</span> canvasHeight = canvas.<span class="property">clientHeight</span></span><br><span class="line">        <span class="comment">//获取canvas画布的宽高 width,height</span></span><br><span class="line">        <span class="keyword">let</span> x = (width/e.<span class="property">offsetX</span>) * <span class="number">2</span> - <span class="number">1</span> </span><br><span class="line">        <span class="keyword">let</span> y = -(height/e.<span class="property">offsetY</span>)*<span class="number">2</span> + <span class="number">1</span></span><br><span class="line">        <span class="keyword">let</span> v2 = <span class="keyword">new</span> three.<span class="title class_">Vector2</span>(x,y)</span><br><span class="line">        raycaster.<span class="title function_">setFromCamera</span>(v2,camera) <span class="comment">//更新一个起点为相机 方向为v2的射线。</span></span><br><span class="line">        <span class="keyword">const</span> arr = rayCaster.<span class="title function_">intersectObjects</span>([mesh3,mesh1,mesh2])<span class="comment">//intersectObjects（）经过其中物体中的哪些呢</span></span><br><span class="line">        <span class="keyword">if</span>(arr.<span class="property">length</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            arr[<span class="number">0</span>].<span class="property">object</span>.<span class="property">material</span>.<span class="property">color</span>.<span class="title function_">set</span>(<span class="string">&#x27;red&#x27;</span>)<span class="comment">//修改经过模型的颜色</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">         <span class="comment">// 如果画布的大小发生了改变那么 我们地重新设置相机的参数 及重新设置渲染器 画布大小 更新摄像机投影矩阵</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#change&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        vue.<span class="property">flog</span> = !vue.<span class="property">flog</span></span><br><span class="line">        <span class="keyword">if</span>(vue.<span class="property">flog</span>)&#123;</span><br><span class="line">            vue.<span class="property">dom</span>.<span class="property">style</span>.<span class="property">width</span> = <span class="string">&#x27;500px&#x27;</span></span><br><span class="line">            vue.<span class="property">dom</span>.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&#x27;500px&#x27;</span></span><br><span class="line">            camera.<span class="property">aspect</span> = canvas.<span class="property">clientWidth</span>/canvas.<span class="property">clientHeight</span> <span class="comment">//设置相机宽高比</span></span><br><span class="line">            renderer.<span class="title function_">setSize</span>(canvas.<span class="property">clientWidth</span>,canvas.<span class="property">clientHeight</span>)<span class="comment">//设置画布大小</span></span><br><span class="line">            camera.<span class="title function_">updateProjectionMatrix</span>()<span class="comment">//更新摄像机投影矩阵。在任何参数被改变以后必须被调用。</span></span><br><span class="line">            <span class="comment">// if(this.model&amp;&amp;this.model)&#123;</span></span><br><span class="line">            <span class="comment">//     console.log(&#x27;处理&#x27;);</span></span><br><span class="line">            <span class="comment">//     // this.model.renderer.setSize(500, 500);</span></span><br><span class="line">            <span class="comment">//     this.model.camera.aspect = 500 / 500;</span></span><br><span class="line">            <span class="comment">//     this.model.camera.updateProjectionMatrix()</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            vue.<span class="property">dom</span>.<span class="property">style</span>.<span class="property">width</span> = <span class="string">&#x27;400px&#x27;</span></span><br><span class="line">            vue.<span class="property">dom</span>.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&#x27;400px&#x27;</span></span><br><span class="line">            camera.<span class="property">aspect</span> = canvas.<span class="property">clientWidth</span>/canvas.<span class="property">clientHeight</span></span><br><span class="line">            renderer.<span class="title function_">setSize</span>(canvas.<span class="property">clientWidth</span>,canvas.<span class="property">clientHeight</span>)</span><br><span class="line">            camera.<span class="title function_">updateProjectionMatrix</span>()</span><br><span class="line">            <span class="comment">// if(this.model)&#123;</span></span><br><span class="line">            <span class="comment">//     console.log(&#x27;调用&#x27;);</span></span><br><span class="line">            <span class="comment">//     // this.model.renderer.setSize(400, 400);</span></span><br><span class="line">            <span class="comment">//     this.model.camera.aspect = 400 / 400;</span></span><br><span class="line">            <span class="comment">//     this.model.camera.updateProjectionMatrix()</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">           </span><br><span class="line">        </span><br><span class="line">    &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="html2D标注CSS2DRender-CSS2DObject"><a href="#html2D标注CSS2DRender-CSS2DObject" class="headerlink" title="html2D标注CSS2DRender&#x2F;CSS2DObject"></a>html2D标注CSS2DRender&#x2F;CSS2DObject</h3><p>在某些场景中我们需要标注一些场景中的模块信息，此时我们需要自己设置信息的排版。CSS2DRender及CSS2DObject就可以实现。</p>
<p><strong>原理</strong>：因为创建的始终为html，所以我们创建的css2dRender是一个html元素，但是这个元素要与three的画布的位置始终保持一致，这样通过CSS2DObject所创建的标注才不会偏移。</p>
<p><strong>CSS2DRender</strong>：场景标注的渲染器，跟webgl渲染器的用法一致，但是需要注意位置与three画布保持一致</p>
<p><strong>CSS2DObject</strong>: 将html转为网格模型的类，转化这个标注也可以设置相关的属性，如position等，因为基类是object3D</p>
<p><strong>标签的位置设置：</strong>需要将标注添加到某个物体附近。1.将标注添加到该模型的子级；2.获取该模型的世界坐标也是可以的； 3. 标签模型对象作为需要标注mesh的子对象，然后获取mesh几何体某个顶点的坐标，作为标签模型对象局部坐标position； </p>
<p><strong>标签偏移：</strong>可以通过设置标签的css定位属性来设置属性的偏移。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> btn = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.tip2D&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> btn2 = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.tip3D&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> btn2D = <span class="keyword">new</span> <span class="title class_">CSS2DObject</span>(btn)</span><br><span class="line">    <span class="comment">//如果需要将这个标注设置在 一个物体上要么获取物体的世界坐标系 或者将这个标注添加到这个物体里面作为子级。</span></span><br><span class="line">    <span class="keyword">let</span> v3 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">50</span>,<span class="number">30</span>,<span class="number">30</span>)</span><br><span class="line">    <span class="comment">// 将标注设置为世界坐标系位置</span></span><br><span class="line">    <span class="comment">// boxMesh.getWorldPosition(v3)</span></span><br><span class="line">    <span class="comment">// 将标注设置为定点位置</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( boxPosition.<span class="title function_">getX</span>(<span class="number">0</span>),<span class="string">&#x27;某个位置&#x27;</span>);</span><br><span class="line">    btn2D.<span class="property">position</span>.<span class="title function_">copy</span>(v3)</span><br><span class="line">    <span class="comment">// scene.add(btn2D)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> glbLoader = <span class="keyword">new</span> <span class="title class_">GLTFLoader</span>()</span><br><span class="line">    <span class="keyword">let</span> n = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> rayCaster = <span class="keyword">new</span> <span class="title class_">Raycaster</span>()</span><br><span class="line">    <span class="keyword">const</span> renderPass = <span class="keyword">new</span> <span class="title class_">RenderPass</span>(scene,camera)</span><br><span class="line">    <span class="keyword">const</span> composer = <span class="keyword">new</span> <span class="title class_">EffectComposer</span>(renderer)</span><br><span class="line">    composer.<span class="title function_">addPass</span>(renderPass)</span><br><span class="line">    <span class="keyword">const</span> outLinePass = <span class="keyword">new</span> <span class="title class_">OutlinePass</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(canvas.<span class="property">clientWidth</span>,canvas.<span class="property">clientHeight</span>),scene,camera)</span><br><span class="line">    <span class="comment">//模型描边颜色</span></span><br><span class="line">    outLinePass.<span class="property">visibleEdgeColor</span>.<span class="title function_">set</span>(<span class="number">0xffff00</span>)</span><br><span class="line">    <span class="comment">//高亮发光描边厚度</span></span><br><span class="line">    outLinePass.<span class="property">edgeThickness</span> = <span class="number">4</span></span><br><span class="line">    <span class="comment">//高亮发光区域的强度</span></span><br><span class="line">    outLinePass.<span class="property">edgeStrength</span> = <span class="number">6</span></span><br><span class="line">    composer.<span class="title function_">addPass</span>(outLinePass)</span><br><span class="line">    glbLoader.<span class="title function_">load</span>(<span class="string">&#x27;/零件.glb&#x27;</span>,<span class="function"><span class="params">gltf</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(gltf,<span class="string">&#x27;模型&#x27;</span>);</span><br><span class="line">        gltf.<span class="property">scene</span>.<span class="title function_">traverse</span>(<span class="function"><span class="params">val</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(val.<span class="property">isMesh</span>||val.<span class="property">isLine</span>)&#123;</span><br><span class="line">                <span class="comment">// val.getWorldPosition(v3)</span></span><br><span class="line">                n+=<span class="number">30</span></span><br><span class="line">                <span class="keyword">if</span>(n==<span class="number">185</span>)&#123;</span><br><span class="line">                    camera.<span class="property">position</span>.<span class="title function_">set</span>(n+<span class="number">10</span>,n+<span class="number">10</span>,n+<span class="number">10</span>)</span><br><span class="line">                    camera.<span class="title function_">lookAt</span>(n,n,n)</span><br><span class="line">                    controls.<span class="property">target</span>.<span class="title function_">set</span>(n,n,n)</span><br><span class="line">                    controls.<span class="title function_">update</span>()</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;相机的位置&#x27;</span>,camera);</span><br><span class="line">                &#125;</span><br><span class="line">                val.<span class="property">position</span>.<span class="title function_">set</span>(n,n,n)</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(val.<span class="property">position</span>,<span class="string">&#x27;???&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// btn.style.top  = &#x27;20px&#x27;</span></span><br><span class="line">        <span class="comment">// btn.style.left  = &#x27;20px&#x27;</span></span><br><span class="line">        <span class="keyword">const</span> tag2D = <span class="keyword">new</span> <span class="title class_">CSS2DObject</span>(btn)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(tag2D,tag3D,<span class="string">&#x27;css对象&#x27;</span>);</span><br><span class="line">        <span class="keyword">let</span> changeObj = <span class="literal">null</span></span><br><span class="line">        <span class="comment">//添加css2d标签</span></span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="function"><span class="params">e</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">let</span> x = (e.<span class="property">offsetX</span>/canvas.<span class="property">clientWidth</span>)*<span class="number">2</span> - <span class="number">1</span></span><br><span class="line">            <span class="keyword">let</span> y = -(e.<span class="property">offsetY</span>/canvas.<span class="property">clientHeight</span>)*<span class="number">2</span> + <span class="number">1</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(x,y);</span><br><span class="line">            <span class="keyword">let</span> v2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(x,y)</span><br><span class="line">            </span><br><span class="line">            rayCaster.<span class="title function_">setFromCamera</span>(v2,camera)</span><br><span class="line">            <span class="keyword">let</span> obj = rayCaster.<span class="title function_">intersectObjects</span>(gltf.<span class="property">scene</span>.<span class="property">children</span>[<span class="number">0</span>].<span class="property">children</span>[<span class="number">0</span>].<span class="property">children</span>)</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(obj);</span><br><span class="line">            <span class="keyword">if</span>(obj.<span class="property">length</span>&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">let</span> a = obj[<span class="number">0</span>].<span class="property">object</span></span><br><span class="line">                outLinePass.<span class="property">selectedObjects</span> = [a]</span><br><span class="line">                changeObj = a</span><br><span class="line">                <span class="keyword">if</span>(a.<span class="property">isLine</span>) a.<span class="title function_">add</span>(tag2D)<span class="comment">//将标注添加到这个对象里面</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">// if(changeObj) changeObj.remove(tag)</span></span><br><span class="line">                <span class="comment">// outLinePass.selectedObjects = []</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">//因为css2Drender 的事件被屏蔽了所以无法触发事件，我们可以单独给某个元素将事件触发开启</span></span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.close1&#x27;</span>).<span class="property">style</span>.<span class="property">pointerEvents</span> = <span class="string">&#x27;auto&#x27;</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.close1&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">              <span class="keyword">if</span>(changeObj) changeObj.<span class="title function_">remove</span>(tag2D)<span class="comment">//关闭弹窗及外边缘发光	</span></span><br><span class="line">                outLinePass.<span class="property">selectedObjects</span> = []</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        scene.<span class="title function_">add</span>(gltf.<span class="property">scene</span>)</span><br><span class="line">        </span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//css3D 渲染器</span></span><br><span class="line">    <span class="keyword">const</span> css3DRender = <span class="keyword">new</span> <span class="title class_">CSS3DRenderer</span>()</span><br><span class="line">    css3DRender.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;absolute&#x27;</span><span class="comment">//设置定位是让css3d这个元素与画布重叠</span></span><br><span class="line">    css3DRender.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">top</span> = <span class="string">&#x27;0px&#x27;</span></span><br><span class="line">    css3DRender.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">pointerEvents</span> = <span class="string">&#x27;none&#x27;</span></span><br><span class="line">    css3DRender.<span class="title function_">setSize</span>(canvas.<span class="property">clientWidth</span>,canvas.<span class="property">clientHeight</span>)</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.screen&#x27;</span>).<span class="title function_">appendChild</span>(css3DRender.<span class="property">domElement</span>)</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        css3DRender.<span class="title function_">setSize</span>(canvas.<span class="property">clientWidth</span>,canvas.<span class="property">clientHeight</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//css2D 渲染器</span></span><br><span class="line">    <span class="keyword">const</span> css2Drender = <span class="keyword">new</span> <span class="title class_">CSS2DRenderer</span>()</span><br><span class="line">    css2Drender.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;absolute&#x27;</span><span class="comment">//设置定位是让css3d这个元素与画布重叠</span></span><br><span class="line">    css2Drender.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">top</span> = <span class="string">&#x27;0px&#x27;</span></span><br><span class="line">    css2Drender.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">pointerEvents</span> = <span class="string">&#x27;none&#x27;</span><span class="comment">//关闭渲染的事件 避免相机或者场景无法点击的问题</span></span><br><span class="line">    css2Drender.<span class="title function_">setSize</span>(canvas.<span class="property">clientWidth</span>,canvas.<span class="property">clientHeight</span>)</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.screen&#x27;</span>).<span class="title function_">appendChild</span>(css2Drender.<span class="property">domElement</span>)</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">//场景的大小也需要更新</span></span><br><span class="line">        css2Drender.<span class="title function_">setSize</span>(canvas.<span class="property">clientWidth</span>,canvas.<span class="property">clientHeight</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">animation</span>(<span class="params"></span>)&#123;</span><br><span class="line">        css2Drender.<span class="title function_">render</span>(scene,camera)</span><br><span class="line">        css3DRender.<span class="title function_">render</span>(scene,camera)</span><br><span class="line">        <span class="comment">// renderer.render(scene,camera)</span></span><br><span class="line">        composer.<span class="title function_">render</span>()</span><br><span class="line">        <span class="title function_">requestAnimationFrame</span>(animation)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">animation</span>()</span><br></pre></td></tr></table></figure>







<h3 id="html3D标注CSS3DRender-CSS3DObject-CSS3DSprite"><a href="#html3D标注CSS3DRender-CSS3DObject-CSS3DSprite" class="headerlink" title="html3D标注CSS3DRender&#x2F;CSS3DObject&#x2F;CSS3DSprite"></a>html3D标注CSS3DRender&#x2F;CSS3DObject&#x2F;CSS3DSprite</h3><p>CSS3DRender与2D的使用基本上一致。不论是css2d还是3d 所创建的标注都不会被物体压住，因为他在一个canvas画布的一个html里面。</p>
<p>**2d与3d的区别:**2d始终朝上 就是普通的Html. 3d是可以跟着旋转与缩放的就如Mesh物体一样，css3d精灵则跟three精灵一样始终始终朝向相机, CSS3精灵模型<code>CSS3DSprite</code>尺寸、位置、缩放等渲染规律和CSS3对象模型<code>CSS3DObject</code>基本一致。 </p>
<p> CSS2渲染的标签和CSS3渲染的标签偏移方式不同，CSS3标签，直接按照threejs模型尺寸修改方式改变，比用HTML像素方式更方便准确。 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">css2采取的是设置css定位属性，而css3采取的是网格的模型位置</span><br><span class="line">css2:</span><br><span class="line">const div = document.getElementById(&#x27;tag&#x27;);</span><br><span class="line">// id=&quot;tag&quot;元素高度322px,默认标签中心与标注点</span><br><span class="line">div.style.top = &#x27;-161px&#x27;; //平移-161px，指示线端点和标注点重合</span><br><span class="line">css3:</span><br><span class="line">tag.scale.set(0.5,0.5,1);//缩放标签尺寸</span><br><span class="line">tag.position.y += 10;//累加标签高度一半，标签底部和圆锥顶部标注位置重合</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line"><span class="keyword">const</span> btn2 = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.tip3D&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> glbLoader = <span class="keyword">new</span> <span class="title class_">GLTFLoader</span>()</span><br><span class="line"><span class="keyword">let</span> n = <span class="number">5</span></span><br><span class="line"><span class="keyword">const</span> rayCaster = <span class="keyword">new</span> <span class="title class_">Raycaster</span>()</span><br><span class="line"><span class="keyword">const</span> renderPass = <span class="keyword">new</span> <span class="title class_">RenderPass</span>(scene,camera)</span><br><span class="line"><span class="keyword">const</span> composer = <span class="keyword">new</span> <span class="title class_">EffectComposer</span>(renderer)</span><br><span class="line">composer.<span class="title function_">addPass</span>(renderPass)</span><br><span class="line"><span class="keyword">const</span> outLinePass = <span class="keyword">new</span> <span class="title class_">OutlinePass</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(canvas.<span class="property">clientWidth</span>,canvas.<span class="property">clientHeight</span>),scene,camera)</span><br><span class="line"><span class="comment">//模型描边颜色</span></span><br><span class="line">outLinePass.<span class="property">visibleEdgeColor</span>.<span class="title function_">set</span>(<span class="number">0xffff00</span>)</span><br><span class="line"><span class="comment">//高亮发光描边厚度</span></span><br><span class="line">outLinePass.<span class="property">edgeThickness</span> = <span class="number">4</span></span><br><span class="line"><span class="comment">//高亮发光区域的强度</span></span><br><span class="line">outLinePass.<span class="property">edgeStrength</span> = <span class="number">6</span></span><br><span class="line">composer.<span class="title function_">addPass</span>(outLinePass)</span><br><span class="line">glbLoader.<span class="title function_">load</span>(<span class="string">&#x27;/零件.glb&#x27;</span>,<span class="function"><span class="params">gltf</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(gltf,<span class="string">&#x27;模型&#x27;</span>);</span><br><span class="line">    gltf.<span class="property">scene</span>.<span class="title function_">traverse</span>(<span class="function"><span class="params">val</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(val.<span class="property">isMesh</span>||val.<span class="property">isLine</span>)&#123;</span><br><span class="line">            <span class="comment">// val.getWorldPosition(v3)</span></span><br><span class="line">            n+=<span class="number">30</span></span><br><span class="line">            <span class="keyword">if</span>(n==<span class="number">185</span>)&#123;</span><br><span class="line">                camera.<span class="property">position</span>.<span class="title function_">set</span>(n+<span class="number">10</span>,n+<span class="number">10</span>,n+<span class="number">10</span>)</span><br><span class="line">                camera.<span class="title function_">lookAt</span>(n,n,n)</span><br><span class="line">                controls.<span class="property">target</span>.<span class="title function_">set</span>(n,n,n)</span><br><span class="line">                controls.<span class="title function_">update</span>()</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;相机的位置&#x27;</span>,camera);</span><br><span class="line">            &#125;</span><br><span class="line">            val.<span class="property">position</span>.<span class="title function_">set</span>(n,n,n)</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(val.<span class="property">position</span>,<span class="string">&#x27;???&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> tag3D = <span class="keyword">new</span> <span class="title class_">CSS3DObject</span>(btn2)</span><br><span class="line">    <span class="comment">//禁止CSS3DObject标签对应HTMl元素背面显示</span></span><br><span class="line">    btn2.<span class="property">style</span>.<span class="property">backface</span>-visibility = <span class="string">&#x27;hidden&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> tagSprite = <span class="keyword">new</span> <span class="title class_">CSS3DSprite</span>(btn2)</span><br><span class="line">    tag3D.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">1</span>);<span class="comment">//缩放标签尺寸</span></span><br><span class="line">    tag3D.<span class="property">position</span>.<span class="property">x</span> += <span class="number">60</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(tag2D,tag3D,<span class="string">&#x27;css对象&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> changeObj = <span class="literal">null</span></span><br><span class="line">    <span class="comment">//添加css2d标签</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="function"><span class="params">e</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> x = (e.<span class="property">offsetX</span>/canvas.<span class="property">clientWidth</span>)*<span class="number">2</span> - <span class="number">1</span></span><br><span class="line">        <span class="keyword">let</span> y = -(e.<span class="property">offsetY</span>/canvas.<span class="property">clientHeight</span>)*<span class="number">2</span> + <span class="number">1</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(x,y);</span><br><span class="line">        <span class="keyword">let</span> v2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(x,y)</span><br><span class="line">        </span><br><span class="line">        rayCaster.<span class="title function_">setFromCamera</span>(v2,camera)</span><br><span class="line">        <span class="keyword">let</span> obj = rayCaster.<span class="title function_">intersectObjects</span>(gltf.<span class="property">scene</span>.<span class="property">children</span>[<span class="number">0</span>].<span class="property">children</span>[<span class="number">0</span>].<span class="property">children</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(obj);</span><br><span class="line">        <span class="keyword">if</span>(obj.<span class="property">length</span>&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">let</span> a = obj[<span class="number">0</span>].<span class="property">object</span></span><br><span class="line">            outLinePass.<span class="property">selectedObjects</span> = [a]</span><br><span class="line">            changeObj = a</span><br><span class="line">            <span class="keyword">if</span>(a.<span class="property">isLine</span>) a.<span class="title function_">add</span>(tag2D)</span><br><span class="line">            <span class="comment">// if(a.isMesh) a.add(tag3D) //css3D 具有跟着缩放的特点，类似于Mesh ,始终是html创建的元素 旋转场景始终在模型上面。</span></span><br><span class="line">            <span class="keyword">if</span>(a.<span class="property">isMesh</span>) a.<span class="title function_">add</span>(tagSprite) <span class="comment">//css3D精灵 类似于精灵图，始终朝着向摄像机。</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// if(changeObj) changeObj.remove(tag)</span></span><br><span class="line">            <span class="comment">// outLinePass.selectedObjects = []</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.close1&#x27;</span>).<span class="property">style</span>.<span class="property">pointerEvents</span> = <span class="string">&#x27;auto&#x27;</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.close1&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          <span class="keyword">if</span>(changeObj) changeObj.<span class="title function_">remove</span>(tag2D)</span><br><span class="line">            outLinePass.<span class="property">selectedObjects</span> = []</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.close2&#x27;</span>).<span class="property">style</span>.<span class="property">pointerEvents</span> = <span class="string">&#x27;auto&#x27;</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.close2&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          <span class="keyword">if</span>(changeObj) changeObj.<span class="title function_">remove</span>(tagSprite)</span><br><span class="line">            outLinePass.<span class="property">selectedObjects</span> = []</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    scene.<span class="title function_">add</span>(gltf.<span class="property">scene</span>)</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//css3D 渲染器</span></span><br><span class="line"><span class="keyword">const</span> css3DRender = <span class="keyword">new</span> <span class="title class_">CSS3DRenderer</span>()</span><br><span class="line">css3DRender.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;absolute&#x27;</span><span class="comment">//设置定位是让css3d这个元素与画布重叠</span></span><br><span class="line">css3DRender.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">top</span> = <span class="string">&#x27;0px&#x27;</span></span><br><span class="line">css3DRender.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">pointerEvents</span> = <span class="string">&#x27;none&#x27;</span></span><br><span class="line">css3DRender.<span class="title function_">setSize</span>(canvas.<span class="property">clientWidth</span>,canvas.<span class="property">clientHeight</span>)</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.screen&#x27;</span>).<span class="title function_">appendChild</span>(css3DRender.<span class="property">domElement</span>)</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    css3DRender.<span class="title function_">setSize</span>(canvas.<span class="property">clientWidth</span>,canvas.<span class="property">clientHeight</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//css2D 渲染器</span></span><br><span class="line"><span class="keyword">const</span> css2Drender = <span class="keyword">new</span> <span class="title class_">CSS2DRenderer</span>()</span><br><span class="line">css2Drender.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;absolute&#x27;</span><span class="comment">//设置定位是让css3d这个元素与画布重叠</span></span><br><span class="line">css2Drender.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">top</span> = <span class="string">&#x27;0px&#x27;</span></span><br><span class="line">css2Drender.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">pointerEvents</span> = <span class="string">&#x27;none&#x27;</span></span><br><span class="line">css2Drender.<span class="title function_">setSize</span>(canvas.<span class="property">clientWidth</span>,canvas.<span class="property">clientHeight</span>)</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.screen&#x27;</span>).<span class="title function_">appendChild</span>(css2Drender.<span class="property">domElement</span>)</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    css2Drender.<span class="title function_">setSize</span>(canvas.<span class="property">clientWidth</span>,canvas.<span class="property">clientHeight</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">animation</span>(<span class="params"></span>)&#123;</span><br><span class="line">    css2Drender.<span class="title function_">render</span>(scene,camera)</span><br><span class="line">    css3DRender.<span class="title function_">render</span>(scene,camera)</span><br><span class="line">    <span class="comment">// renderer.render(scene,camera)</span></span><br><span class="line">    composer.<span class="title function_">render</span>()</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(animation)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">animation</span>()</span><br></pre></td></tr></table></figure>

<p>添加多i个标注</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">    let num = 0</span><br><span class="line"></span><br><span class="line">    for(let i=0;i&lt;5;i++)&#123;</span><br><span class="line">        glbLoader.load(&#x27;tree2.glb&#x27;,glb=&gt;&#123;</span><br><span class="line">            console.log(glb,&#x27;shu&#x27;);</span><br><span class="line">            glb.scene.traverse(item=&gt;&#123;</span><br><span class="line">                if(item.isMesh)&#123;</span><br><span class="line">                    console.log(item,&#x27;shuju &#x27;);</span><br><span class="line">                    // item.material.emissive.set(&#x27;red&#x27;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">            glb.scene.scale.set(0.1,0.1,0.1)</span><br><span class="line">            glb.scene.position.set(num,0,num)</span><br><span class="line"></span><br><span class="line">            // 创建树的标签 css2D 如果需要将标签的位置设置在某个物体顶上的话 如果只设置css定位，缩放时标签会偏移；建议还是用精准定位标签的position属性 </span><br><span class="line">            const treeDom = document.querySelector(&#x27;.treeName&#x27;).cloneNode()</span><br><span class="line">            treeDom.innerHTML = &#x27;第&#x27;+(i+1)+&#x27;棵树&#x27;</span><br><span class="line">            const treeTip = new CSS2DObject(treeDom)</span><br><span class="line">            //方案1：将标签添加到该模型中 单独设置y的坐标</span><br><span class="line">            // treeTip.position.y = 500</span><br><span class="line">            // glb.scene.add(treeTip)</span><br><span class="line">            //方案2：获取模型的世界坐标，在修改y的坐标</span><br><span class="line">            // let adr = new THREE.Vector3()</span><br><span class="line">            // glb.scene.getWorldPosition(adr)</span><br><span class="line">            // adr.y += 50</span><br><span class="line">            // treeTip.position.copy(adr)</span><br><span class="line">            // // treeTip.position.x = 50  </span><br><span class="line">            // console.log(treeTip);</span><br><span class="line">            // scene.add(treeTip)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            // 添加css3d精灵 css3d的精灵不能不能被物体遮挡</span><br><span class="line">            // const iconDom = document.querySelector(&#x27;.icon&#x27;).cloneNode()</span><br><span class="line">            // const iconSprite = new CSS3DSprite(iconDom)</span><br><span class="line">            // iconSprite.position.y = 400</span><br><span class="line">            // glb.scene.add(iconSprite)</span><br><span class="line"></span><br><span class="line">            // 添加精灵模型 精灵模型可以被物体遮挡。</span><br><span class="line">            // const textureLoad = new THREE.TextureLoader()</span><br><span class="line">            // let spriteImg =   textureLoad.load(&#x27;/警戒.png&#x27;)</span><br><span class="line">            // const spriteM = new THREE.SpriteMaterial(&#123;map:spriteImg&#125;)</span><br><span class="line">            // const sprite = new THREE.Sprite(spriteM)</span><br><span class="line">            // sprite.position.y = 450</span><br><span class="line">            // sprite.scale.set(100,100,100)</span><br><span class="line">            // glb.scene.add(sprite)</span><br><span class="line"></span><br><span class="line">           </span><br><span class="line">            //通过canvas来作为精灵的贴图绘制标注</span><br><span class="line">            let tipcanvas = createCanvas()</span><br><span class="line">            const canvasTexture = new THREE.CanvasTexture(tipcanvas)</span><br><span class="line">            const spriteM2 = new THREE.SpriteMaterial(&#123;map:canvasTexture&#125;)</span><br><span class="line">            const sprite2 = new THREE.Sprite(spriteM2)</span><br><span class="line">            sprite2.position.y = 450</span><br><span class="line">            sprite2.scale.set(canvas.width/canvas.height*100,100,100)</span><br><span class="line">            glb.scene.add(sprite2)</span><br><span class="line"></span><br><span class="line">            scene.add(glb.scene)</span><br><span class="line">            num+=20</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	function createCanvas(src=&#x27;house/nz (1).png&#x27;)&#123;</span><br><span class="line">    const img = new Image()</span><br><span class="line">    img.src = src</span><br><span class="line">    //通过canvas来绘制精灵模型的贴图</span><br><span class="line">    const tipCan = document.createElement(&#x27;canvas&#x27;)</span><br><span class="line">    let str = &#x27;设备A&#x27;</span><br><span class="line">    let arr = str.split(&#x27;&#x27;)</span><br><span class="line">    const arc = /[\u4e00-\u9fa5]/</span><br><span class="line">    let strLength = 0 //字符串的长度</span><br><span class="line">    for(let i = 0;i&lt;arr.length;i++)&#123;</span><br><span class="line">        if(arc.test(arr[0]))&#123;//判断的是否为汉字 是汉字+1</span><br><span class="line">            strLength+=1</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            strLength+=0.0 //是应为或者其他符号 则+0.5</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // 根据字体符号类型和数量，文字font-size大小来设置canvas画布的宽度</span><br><span class="line">    const h = 80</span><br><span class="line">    const w = h + strLength*32</span><br><span class="line">    tipCan.width = w</span><br><span class="line">    tipCan.height = h</span><br><span class="line"></span><br><span class="line">    const h1 = h*0.8</span><br><span class="line">    const c = tipCan.getContext(&#x27;2d&#x27;)//获取canvas的上下文 才能绘制</span><br><span class="line">    const r = h1/2</span><br><span class="line">    c.arc(r,r,r,-Math.PI/2,Math.PI/2,true)//顺势针旋转半圆</span><br><span class="line">    c.arc(w-r,r,r,Math.PI/2,-Math.PI/2,true)//顺势针旋转半圆</span><br><span class="line">    // c.fillStyle = &quot;rgba(0,0,0,0.0)&quot;; //背景透明</span><br><span class="line">    // c.fillRect(0, 0, w, h);</span><br><span class="line">    c.fillStyle = &quot;rgba(255,255,255,1)&quot;; </span><br><span class="line">    c.fill()</span><br><span class="line">    // c.drawImage(img, 0, 0, w, h);//图片绘制到canvas画布上</span><br><span class="line">    // 箭头</span><br><span class="line">    c.beginPath()</span><br><span class="line">    const h2 = h-h1</span><br><span class="line">    c.moveTo(w/2-h2*0.6,h1)</span><br><span class="line">    c.lineTo(w/2+h2*0.6,h1)</span><br><span class="line">    c.lineTo(w/2,h)</span><br><span class="line">    c.fill()</span><br><span class="line">    // 文字</span><br><span class="line">    c.beginPath()</span><br><span class="line">    c.translate(w/2,h1/2)</span><br><span class="line">    c.fillStyle = &#x27;#000000&#x27;//文本填充色</span><br><span class="line">    c.font = &#x27;normal 32px 宋体&#x27;//文本的字体</span><br><span class="line">    c.textBaseline = &#x27;middle&#x27;//文本与fillText定义的纵坐标，对齐线</span><br><span class="line">    c.textAlign = &quot;center&quot;; //文本居中(以fillText定义的横坐标)</span><br><span class="line">    c.fillText(str,0,0)</span><br><span class="line"></span><br><span class="line">    return tipCan</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="着色器材质（重要）"><a href="#着色器材质（重要）" class="headerlink" title="着色器材质（重要）"></a>着色器材质（重要）</h3><p>着色器是 <code>WebGL</code> 的重要组件之一， shader 它是一种使用 <code>GLSL</code> 语言编写的运行在 <code>GPU</code> 上的小程序。顾名思义，着色器用于定位几何体的每个顶点，并为几何体的每个可见像素进行着色 。着色器是屏幕上呈现画面之前的最后一步，用它可以实现对先前渲染结果进行修改，如颜色、位置等，也可以对先前渲染的结果做后处理，实现高级的渲染效果。</p>
<h3 id="资源网站"><a href="#资源网站" class="headerlink" title="资源网站"></a>资源网站</h3><ul>
<li><p>3D模型下载：<a target="_blank" rel="noopener" href="https://sketchfab.com/">https://sketchfab.com/</a></p>
</li>
<li><p>骨骼自动绑定：<a target="_blank" rel="noopener" href="https://www.mixamo.com/">https://www.mixamo.com/</a></p>
</li>
<li><p>360°全景图裁切工具（收费）：<a target="_blank" rel="noopener" href="https://www.ptgui.com/download.html?ps=main">https://www.ptgui.com/download.html?ps=main</a></p>
</li>
<li><p>天空盒切割工具：<a target="_blank" rel="noopener" href="https://matheowis.github.io/HDRI-to-CubeMap/">https://matheowis.github.io/HDRI-to-CubeMap/</a></p>
</li>
<li><p>超全GSAP动画库：<a target="_blank" rel="noopener" href="https://greensock.com/">https://greensock.com/</a></p>
</li>
<li><p>three官方文档：<a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#manual/zh/introduction/Creating-a-scene">https://threejs.org/docs/index.html#manual/zh/introduction/Creating-a-scene</a></p>
</li>
<li><p>在线免费教程：<a target="_blank" rel="noopener" href="http://www.webgl3d.cn/Three.js/">http://www.webgl3d.cn/Three.js/</a></p>
</li>
<li><p>cannon 物理引擎：<a target="_blank" rel="noopener" href="https://github.com/pmndrs/cannon-es">https://github.com/pmndrs/cannon-es</a></p>
</li>
<li><p>Physijs 物理引擎：<a target="_blank" rel="noopener" href="https://github.com/chandlerprall/Physijs">https://github.com/chandlerprall/Physijs</a></p>
</li>
<li><p>tween.js 创建补间动画（控制机械、游戏角色运动）：<a target="_blank" rel="noopener" href="https://github.com/tweenjs/tween.js/">https://github.com/tweenjs/tween.js/</a></p>
</li>
<li><p>dat.gui 轻量级控制器：<a target="_blank" rel="noopener" href="https://github.com/dataarts/dat.gui">https://github.com/dataarts/dat.gui</a></p>
</li>
<li><p>stats.js 性能监控器（webgl渲染性能）：<a target="_blank" rel="noopener" href="https://github.com/mrdoob/stats.js">https://github.com/mrdoob/stats.js</a></p>
</li>
<li><p>3D素材网-1：<a target="_blank" rel="noopener" href="https://www.poliigon.com/textures">https://www.poliigon.com/textures</a></p>
</li>
<li><p>3D素材网-2：<a target="_blank" rel="noopener" href="https://www.aigei.com/">https://www.aigei.com/</a></p>
</li>
<li><p>3D素材网-3（10次&#x2F;天免费下载）：<a target="_blank" rel="noopener" href="https://www.3dsmj.com/">https://www.3dsmj.com/</a></p>
<h5 id="模型网站"><a href="#模型网站" class="headerlink" title="模型网站"></a>模型网站</h5></li>
<li><p>1，Turbosquid</p>
</li>
<li><p>2，Free 3D</p>
</li>
<li><p>3，ShareOG</p>
</li>
<li><p>4，3Delicious</p>
</li>
<li><p>5，Oyonale</p>
</li>
<li><p>6，Telias</p>
</li>
<li><p>7，Cults</p>
</li>
</ul>

    </div>

    
    
    
        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/images/wechat_channel.jpg">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>



      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/ThreeJS/" rel="tag"># ThreeJS</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/blog/2023/12/03/nuxt/" rel="prev" title="nuxt">
      <i class="fa fa-chevron-left"></i> nuxt
    </a></div>
      <div class="post-nav-item">
    <a href="/blog/2025/02/11/phaser3/" rel="next" title="phaser3">
      phaser3 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80"><span class="nav-number">1.</span> <span class="nav-text">基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%90%E8%B4%A8"><span class="nav-number">1.1.</span> <span class="nav-text">材质</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E7%B1%BB%EF%BC%9AMaterial"><span class="nav-number">1.1.1.</span> <span class="nav-text">基类：Material</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9D%90%E8%B4%A8%E6%88%96%E9%9B%86%E5%90%88%E4%BD%93%E5%85%B1%E4%BA%AB"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">材质或集合体共享</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%89%E7%BB%B4%E5%8F%98%E9%87%8F%E7%9A%84%E5%85%8B%E9%9A%86%E5%92%8C%E5%A4%8D%E5%88%B6%E6%96%B9%E6%B3%95"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">三维变量的克隆和复制方法</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A1%B6%E7%82%B9%EF%BC%9A"><span class="nav-number">1.1.2.</span> <span class="nav-text">顶点：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E5%AF%B9%E8%B1%A1group"><span class="nav-number">1.2.</span> <span class="nav-text">组对象group</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A8%A1%E5%9E%8B%E6%95%B0%E7%9A%84%E9%81%8D%E5%8E%86"><span class="nav-number">1.2.1.</span> <span class="nav-text">模型数的遍历</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A8%A1%E5%9E%8B-gltf"><span class="nav-number">1.2.2.</span> <span class="nav-text">模型:gltf</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%B9%E7%90%86"><span class="nav-number">1.2.3.</span> <span class="nav-text">纹理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF%E7%9A%84%E8%83%8C%E6%99%AF%EF%BC%9A"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">场景的背景：</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AF%BC%E5%87%BA%E5%9B%BE%E7%89%87%EF%BC%9A"><span class="nav-number">1.2.3.1.1.</span> <span class="nav-text">导出图片：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#mesh%E9%87%8D%E5%8F%A0%E6%97%B6%E5%80%99%E4%BC%9A%E5%87%BA%E7%8E%B0%E9%97%AA%E7%BC%A9%E7%9A%84%E6%83%85%E5%86%B5%E5%8F%AB%E5%81%9A%E6%B7%B1%E5%BA%A6%E5%86%B2%E7%AA%81%EF%BC%88z-fighting%EF%BC%89"><span class="nav-number">1.2.3.1.2.</span> <span class="nav-text">mesh重叠时候会出现闪缩的情况叫做深度冲突（z-fighting）</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%92%E7%BA%BF%EF%BC%9A%E9%A1%B6%E7%82%B9%E6%95%B0%E6%8D%AE%E6%9D%A5%E7%94%BB"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">自定义划线：顶点数据来画</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9B%B2%E7%BA%BF%EF%BC%9A%E5%9F%BA%E7%B1%BBcuver"><span class="nav-number">1.2.3.3.</span> <span class="nav-text">曲线：基类cuver</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%A1%E9%81%93%E5%87%A0%E4%BD%95%E4%BD%93"><span class="nav-number">1.3.</span> <span class="nav-text">管道几何体</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%8B%E8%BD%AC%E6%88%90%E5%9E%8B%E5%87%A0%E4%BD%95%E4%BD%93"><span class="nav-number">1.4.</span> <span class="nav-text">旋转成型几何体</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BD%A2%E7%8A%B6%E5%87%A0%E4%BD%95%E4%BD%93"><span class="nav-number">1.5.</span> <span class="nav-text">形状几何体</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E8%BE%B9%E5%BD%A2%E8%BD%AE%E5%BB%93shape-%E9%87%8D%E7%82%B9"><span class="nav-number">1.6.</span> <span class="nav-text">多边形轮廓shape(重点)</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%86%85%E5%AD%94%EF%BC%9Aholes"><span class="nav-number">1.6.0.0.1.</span> <span class="nav-text">内孔：holes</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BE%B9%E7%BC%98%E5%87%A0%E4%BD%95%E4%BD%93"><span class="nav-number">1.7.</span> <span class="nav-text">边缘几何体</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8B%89%E4%BC%B8%E5%87%A0%E4%BD%95%E4%BD%93"><span class="nav-number">1.8.</span> <span class="nav-text">拉伸几何体</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BC%AF%E6%9B%B2%E6%B0%B4%E7%AE%A1%E6%B5%81%E5%8A%A8%E6%95%88%E6%9E%9C%EF%BC%9A"><span class="nav-number">1.8.0.1.</span> <span class="nav-text">弯曲水管流动效果：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%A0%E4%BD%95%E4%BD%93%E7%9A%84%E9%A1%B6%E7%82%B9%E5%B1%9E%E6%80%A7"><span class="nav-number">1.9.</span> <span class="nav-text">几何体的顶点属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Color%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">1.10.</span> <span class="nav-text">Color的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#color%E7%9A%84%E6%8F%92%E5%80%BC"><span class="nav-number">1.10.0.0.1.</span> <span class="nav-text">color的插值</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9E%8B%E7%9A%84%E9%A1%B6%E7%82%B9%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="nav-number">1.11.</span> <span class="nav-text">模型的顶点及数据处理</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#BufferAttribute%E5%85%B7%E6%9C%89getX-getY-getZ-%E6%96%B9%E6%B3%95%E8%8E%B7%E5%8F%96x-1%E7%BB%B4-y-2%E7%BB%B4-z-3%E7%BB%B4-%E6%8C%87%E5%AE%9A%E9%A1%B9%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="nav-number">1.11.0.0.1.</span> <span class="nav-text">BufferAttribute具有getX(), getY() ,getZ() 方法获取x(1维) y(2维) z(3维) 指定项的数据</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E6%9C%BAcamera"><span class="nav-number">1.12.</span> <span class="nav-text">相机camera</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WebGL%E6%B8%B2%E6%9F%93%E5%99%A8%E6%9B%B4%E6%96%B0Canvas%E7%94%BB%E5%B8%83%E5%B0%BA%E5%AF%B8"><span class="nav-number">1.13.</span> <span class="nav-text">WebGL渲染器更新Canvas画布尺寸</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%85%E5%9B%B4%E7%9B%92"><span class="nav-number">1.14.</span> <span class="nav-text">包围盒</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%8C%85%E5%9B%B4%E7%9B%92%E5%9C%B0%E5%9B%BE%E6%A1%88%E4%BE%8B%EF%BC%9A"><span class="nav-number">1.14.0.0.1.</span> <span class="nav-text">包围盒地图案例：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%AE%A1%E9%81%93%E7%A9%BF%E6%A2%AD%E6%A1%88%E4%BE%8B%EF%BC%9A"><span class="nav-number">1.14.0.0.2.</span> <span class="nav-text">管道穿梭案例：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%9B%B8%E6%9C%BA%E6%8E%A7%E4%BB%B6OrbitControls"><span class="nav-number">1.14.0.0.3.</span> <span class="nav-text">相机控件OrbitControls</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%89%E6%BA%90-light"><span class="nav-number">1.15.</span> <span class="nav-text">光源:light</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B2%BE%E7%81%B5%EF%BC%9Asprite"><span class="nav-number">1.16.</span> <span class="nav-text">精灵：sprite</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8E%E5%A4%84%E7%90%86%EF%BC%9A-EffectComposer"><span class="nav-number">1.17.</span> <span class="nav-text">后处理： EffectComposer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%84%E7%BA%BFRay%EF%BC%88%E9%87%8D%E7%82%B9%EF%BC%89"><span class="nav-number">1.18.</span> <span class="nav-text">射线Ray（重点）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#html2D%E6%A0%87%E6%B3%A8CSS2DRender-CSS2DObject"><span class="nav-number">1.19.</span> <span class="nav-text">html2D标注CSS2DRender&#x2F;CSS2DObject</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#html3D%E6%A0%87%E6%B3%A8CSS3DRender-CSS3DObject-CSS3DSprite"><span class="nav-number">1.20.</span> <span class="nav-text">html3D标注CSS3DRender&#x2F;CSS3DObject&#x2F;CSS3DSprite</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9D%80%E8%89%B2%E5%99%A8%E6%9D%90%E8%B4%A8%EF%BC%88%E9%87%8D%E8%A6%81%EF%BC%89"><span class="nav-number">1.21.</span> <span class="nav-text">着色器材质（重要）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B5%84%E6%BA%90%E7%BD%91%E7%AB%99"><span class="nav-number">1.22.</span> <span class="nav-text">资源网站</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A8%A1%E5%9E%8B%E7%BD%91%E7%AB%99"><span class="nav-number">1.22.0.1.</span> <span class="nav-text">模型网站</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="veizj"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">veizj</p>
  <div class="site-description" itemprop="description">选择有时候比努力更重要</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/yourname" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/yourname" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://plus.google.com/yourname" title="Google → https:&#x2F;&#x2F;plus.google.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-google fa-fw"></i>Google</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://youtube.com/yourname" title="YouTube → https:&#x2F;&#x2F;youtube.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-youtube fa-fw"></i>YouTube</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2023-08 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">veizj</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">104k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">1:35</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>



        








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.8' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
